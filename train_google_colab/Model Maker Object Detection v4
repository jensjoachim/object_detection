{"cells":[{"cell_type":"markdown","metadata":{"id":"Gb7qyhNL1yWt"},"source":["# Object Detection with TensorFlow Lite Model Maker"]},{"cell_type":"markdown","metadata":{"id":"UbgFQYZNYM_9"},"source":["Set Dataset"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"_m8AYCXvWOiv"},"outputs":[],"source":["#class_input      = ['Person', 'Dog', 'Cat', 'Human head', 'Deer']\n","#class_input      = ['Person', 'Dog', 'Cat', 'Human head', 'Deer', 'Squirrel', 'Bird', 'Rabbit', 'Fox']\n","class_input      = ['Person', 'Dog', 'Cat', 'Human head', 'Deer', 'Squirrel', 'Bird']\n","#train_per_class  = 100\n","train_per_class  = 2000\n","#train_per_class  = 24"]},{"cell_type":"markdown","metadata":{"id":"GZ5-Rfa2YPk4"},"source":["Set Model\n","May only be efficientdet-lite[n], for n = 0..4"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"cSNhHPdMYbfm"},"outputs":[],"source":["spec_str = 'efficientdet-lite1'"]},{"cell_type":"markdown","metadata":{"id":"Y53ArDfHY9d5"},"source":["Set epochs as list. Each index will generate a seperate model."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"GBZvYmJOY8gC"},"outputs":[],"source":["epochs_per_class_list = [50, 75, 100, 150]\n","#epochs_per_class_list = [150]\n","#epochs_per_class_list = [2]"]},{"cell_type":"markdown","metadata":{"id":"bcLF2PKkSbV3"},"source":["## Prerequisites\n"]},{"cell_type":"markdown","metadata":{"id":"8YKCQBvIf8LV"},"source":["Connect to google drive for transfer of model."]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true,"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":18589,"status":"ok","timestamp":1660745087248,"user":{"displayName":"Jens Joachim Pedersen","userId":"12704241209616827899"},"user_tz":-120},"id":"SuRd1nRXgAvH"},"outputs":[{"name":"stdout","output_type":"stream","text":["Mounted at /content/drive\n"]}],"source":["from google.colab import drive\n","drive.mount('/content/drive')"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true,"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":10,"status":"ok","timestamp":1660745087248,"user":{"displayName":"Jens Joachim Pedersen","userId":"12704241209616827899"},"user_tz":-120},"id":"k62t4joMe7oH"},"outputs":[{"name":"stdout","output_type":"stream","text":["Thu Aug 18 06:22:57 2022       \n","+-----------------------------------------------------------------------------+\n","| NVIDIA-SMI 460.32.03    Driver Version: 460.32.03    CUDA Version: 11.2     |\n","|-------------------------------+----------------------+----------------------+\n","| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\n","| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\n","|                               |                      |               MIG M. |\n","|===============================+======================+======================|\n","|   0  Tesla P100-PCIE...  Off  | 00000000:00:04.0 Off |                    0 |\n","| N/A   43C    P0    29W / 250W |      0MiB / 16280MiB |      0%      Default |\n","|                               |                      |                  N/A |\n","+-------------------------------+----------------------+----------------------+\n","                                                                               \n","+-----------------------------------------------------------------------------+\n","| Processes:                                                                  |\n","|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |\n","|        ID   ID                                                   Usage      |\n","|=============================================================================|\n","|  No running processes found                                                 |\n","+-----------------------------------------------------------------------------+\n"]}],"source":["gpu_info = !nvidia-smi\n","gpu_info = '\\n'.join(gpu_info)\n","if gpu_info.find('failed') \u003e= 0:\n","  print('Not connected to a GPU')\n","else:\n","  print(gpu_info)"]},{"cell_type":"markdown","metadata":{"id":"2vvAObmTqglq"},"source":["### Install the required packages\n","Start by installing the required packages, including the Model Maker package from the [GitHub repo](https://github.com/tensorflow/examples/tree/master/tensorflow_examples/lite/model_maker) and the pycocotools library you'll use for evaluation."]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true,"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":120519,"status":"ok","timestamp":1660745207763,"user":{"displayName":"Jens Joachim Pedersen","userId":"12704241209616827899"},"user_tz":-120},"id":"qhl8lqVamEty"},"outputs":[{"name":"stdout","output_type":"stream","text":["Reading package lists... Done\n","Building dependency tree       \n","Reading state information... Done\n","The following package was automatically installed and is no longer required:\n","  libnvidia-common-460\n","Use 'sudo apt autoremove' to remove it.\n","The following NEW packages will be installed:\n","  libportaudio2\n","0 upgraded, 1 newly installed, 0 to remove and 20 not upgraded.\n","Need to get 64.6 kB of archives.\n","After this operation, 215 kB of additional disk space will be used.\n","Get:1 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libportaudio2 amd64 19.6.0-1 [64.6 kB]\n","Fetched 64.6 kB in 0s (1,046 kB/s)\n","debconf: unable to initialize frontend: Dialog\n","debconf: (No usable dialog-like program is installed, so the dialog based frontend cannot be used. at /usr/share/perl5/Debconf/FrontEnd/Dialog.pm line 76, \u003c\u003e line 1.)\n","debconf: falling back to frontend: Readline\n","debconf: unable to initialize frontend: Readline\n","debconf: (This frontend requires a controlling tty.)\n","debconf: falling back to frontend: Teletype\n","dpkg-preconfigure: unable to re-open stdin: \n","Selecting previously unselected package libportaudio2:amd64.\n","(Reading database ... 155676 files and directories currently installed.)\n","Preparing to unpack .../libportaudio2_19.6.0-1_amd64.deb ...\n","Unpacking libportaudio2:amd64 (19.6.0-1) ...\n","Setting up libportaudio2:amd64 (19.6.0-1) ...\n","Processing triggers for libc-bin (2.27-3ubuntu1.5) ...\n","\u001b[K     |████████████████████████████████| 642 kB 12.5 MB/s \n","\u001b[K     |████████████████████████████████| 596 kB 49.3 MB/s \n","\u001b[K     |████████████████████████████████| 1.1 MB 54.6 MB/s \n","\u001b[K     |████████████████████████████████| 87 kB 5.7 MB/s \n","\u001b[K     |████████████████████████████████| 3.4 MB 58.8 MB/s \n","\u001b[K     |████████████████████████████████| 10.9 MB 58.5 MB/s \n","\u001b[K     |████████████████████████████████| 1.3 MB 36.2 MB/s \n","\u001b[K     |████████████████████████████████| 128 kB 52.0 MB/s \n","\u001b[K     |████████████████████████████████| 60.2 MB 79.5 MB/s \n","\u001b[K     |████████████████████████████████| 238 kB 51.3 MB/s \n","\u001b[K     |████████████████████████████████| 840 kB 61.5 MB/s \n","\u001b[K     |████████████████████████████████| 78 kB 6.3 MB/s \n","\u001b[K     |████████████████████████████████| 25.3 MB 36.7 MB/s \n","\u001b[K     |████████████████████████████████| 213 kB 63.2 MB/s \n","\u001b[K     |████████████████████████████████| 352 kB 59.4 MB/s \n","\u001b[K     |████████████████████████████████| 99 kB 8.4 MB/s \n","\u001b[?25h  Building wheel for fire (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Building wheel for py-cpuinfo (setup.py) ... \u001b[?25l\u001b[?25hdone\n","\u001b[31mERROR: pip's legacy dependency resolver does not consider dependency conflicts when selecting packages. This behaviour is the source of the following dependency conflicts.\n","scann 1.2.6 requires tensorflow~=2.8.0, but you'll have tensorflow 2.9.1 which is incompatible.\n","tflite-support-nightly 0.4.0.dev20220816 requires flatbuffers\u003e=2.0, but you'll have flatbuffers 1.12 which is incompatible.\n","tflite-support-nightly 0.4.0.dev20220816 requires protobuf\u003c4,\u003e=3.18.0, but you'll have protobuf 3.17.3 which is incompatible.\n","tensorflowjs 3.19.0 requires packaging~=20.9, but you'll have packaging 21.3 which is incompatible.\n","tensorflowjs 3.19.0 requires protobuf==3.20.0, but you'll have protobuf 3.17.3 which is incompatible.\u001b[0m\n","\u001b[K     |████████████████████████████████| 21.8 MB 228 kB/s \n","\u001b[?25hFound existing installation: tensorflow 2.9.1\n","Uninstalling tensorflow-2.9.1:\n","  Successfully uninstalled tensorflow-2.9.1\n","\u001b[K     |████████████████████████████████| 668.3 MB 14 kB/s \n","\u001b[K     |████████████████████████████████| 5.8 MB 12.2 MB/s \n","\u001b[K     |████████████████████████████████| 462 kB 67.0 MB/s \n","\u001b[K     |████████████████████████████████| 1.4 MB 55.0 MB/s \n","\u001b[31mERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.\n","tensorflowjs 3.19.0 requires packaging~=20.9, but you have packaging 21.3 which is incompatible.\n","tensorflowjs 3.19.0 requires protobuf==3.20.0, but you have protobuf 3.17.3 which is incompatible.\u001b[0m\n","\u001b[?25h"]}],"source":["!sudo apt -y install libportaudio2\n","!pip install -q --use-deprecated=legacy-resolver tflite-model-maker\n","!pip install -q pycocotools\n","!pip install -q opencv-python-headless==4.1.2.30\n","!pip uninstall -y tensorflow \u0026\u0026 pip install -q tensorflow==2.8.0"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true,"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":2928,"status":"ok","timestamp":1660745210684,"user":{"displayName":"Jens Joachim Pedersen","userId":"12704241209616827899"},"user_tz":-120},"id":"AQ-dyy6airg6"},"outputs":[{"name":"stdout","output_type":"stream","text":["Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Collecting flatbuffers==2.0\n","  Downloading flatbuffers-2.0-py2.py3-none-any.whl (26 kB)\n","Installing collected packages: flatbuffers\n","  Attempting uninstall: flatbuffers\n","    Found existing installation: flatbuffers 1.12\n","    Uninstalling flatbuffers-1.12:\n","      Successfully uninstalled flatbuffers-1.12\n","\u001b[31mERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.\n","tflite-support-nightly 0.4.0.dev20220816 requires protobuf\u003c4,\u003e=3.18.0, but you have protobuf 3.17.3 which is incompatible.\n","tflite-model-maker 0.4.1 requires flatbuffers==1.12, but you have flatbuffers 2.0 which is incompatible.\u001b[0m\n","Successfully installed flatbuffers-2.0\n"]}],"source":["!pip install flatbuffers==2.0"]},{"cell_type":"markdown","metadata":{"id":"KKB0fDQ-HrWA"},"source":["Install the EdgeTPU Compiler"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true,"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":8279,"status":"ok","timestamp":1660745218960,"user":{"displayName":"Jens Joachim Pedersen","userId":"12704241209616827899"},"user_tz":-120},"id":"pQ20bhEHHX2x"},"outputs":[{"name":"stdout","output_type":"stream","text":["  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","100  2537  100  2537    0     0  81838      0 --:--:-- --:--:-- --:--:-- 81838\n","OK\n","deb https://packages.cloud.google.com/apt coral-edgetpu-stable main\n","Get:1 http://ppa.launchpad.net/c2d4u.team/c2d4u4.0+/ubuntu bionic InRelease [15.9 kB]\n","Hit:2 http://ppa.launchpad.net/cran/libgit2/ubuntu bionic InRelease\n","Hit:3 http://ppa.launchpad.net/deadsnakes/ppa/ubuntu bionic InRelease\n","Hit:4 http://ppa.launchpad.net/graphics-drivers/ppa/ubuntu bionic InRelease\n","Get:5 http://ppa.launchpad.net/c2d4u.team/c2d4u4.0+/ubuntu bionic/main Sources [2,095 kB]\n","Get:6 http://ppa.launchpad.net/c2d4u.team/c2d4u4.0+/ubuntu bionic/main amd64 Packages [1,073 kB]\n","Get:7 https://cloud.r-project.org/bin/linux/ubuntu bionic-cran40/ InRelease [3,626 B]\n","Ign:8 https://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1804/x86_64  InRelease\n","Get:9 https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64  InRelease [1,581 B]\n","Hit:10 https://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1804/x86_64  Release\n","Get:11 http://security.ubuntu.com/ubuntu bionic-security InRelease [88.7 kB]\n","Get:12 https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64  Packages [910 kB]\n","Hit:13 http://archive.ubuntu.com/ubuntu bionic InRelease\n","Get:14 http://archive.ubuntu.com/ubuntu bionic-updates InRelease [88.7 kB]\n","Get:15 http://archive.ubuntu.com/ubuntu bionic-backports InRelease [74.6 kB]\n","Get:17 http://security.ubuntu.com/ubuntu bionic-security/universe amd64 Packages [1,533 kB]\n","Get:18 https://packages.cloud.google.com/apt coral-edgetpu-stable InRelease [6,722 B]\n","Get:19 http://security.ubuntu.com/ubuntu bionic-security/main amd64 Packages [2,937 kB]\n","Get:20 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 Packages [3,369 kB]\n","Get:21 http://archive.ubuntu.com/ubuntu bionic-updates/universe amd64 Packages [2,310 kB]\n","Get:22 https://packages.cloud.google.com/apt coral-edgetpu-stable/main amd64 Packages [2,317 B]\n","Fetched 14.5 MB in 2s (7,653 kB/s)\n","Reading package lists... Done\n","Reading package lists... Done\n","Building dependency tree       \n","Reading state information... Done\n","The following package was automatically installed and is no longer required:\n","  libnvidia-common-460\n","Use 'sudo apt autoremove' to remove it.\n","The following NEW packages will be installed:\n","  edgetpu-compiler\n","0 upgraded, 1 newly installed, 0 to remove and 22 not upgraded.\n","Need to get 7,913 kB of archives.\n","After this operation, 31.2 MB of additional disk space will be used.\n","Get:1 https://packages.cloud.google.com/apt coral-edgetpu-stable/main amd64 edgetpu-compiler amd64 16.0 [7,913 kB]\n","Fetched 7,913 kB in 0s (16.6 MB/s)\n","debconf: unable to initialize frontend: Dialog\n","debconf: (No usable dialog-like program is installed, so the dialog based frontend cannot be used. at /usr/share/perl5/Debconf/FrontEnd/Dialog.pm line 76, \u003c\u003e line 1.)\n","debconf: falling back to frontend: Readline\n","debconf: unable to initialize frontend: Readline\n","debconf: (This frontend requires a controlling tty.)\n","debconf: falling back to frontend: Teletype\n","dpkg-preconfigure: unable to re-open stdin: \n","Selecting previously unselected package edgetpu-compiler.\n","(Reading database ... 155682 files and directories currently installed.)\n","Preparing to unpack .../edgetpu-compiler_16.0_amd64.deb ...\n","Unpacking edgetpu-compiler (16.0) ...\n","Setting up edgetpu-compiler (16.0) ...\n","Processing triggers for libc-bin (2.27-3ubuntu1.5) ...\n"]}],"source":["! curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -\n","\n","! echo \"deb https://packages.cloud.google.com/apt coral-edgetpu-stable main\" | sudo tee /etc/apt/sources.list.d/coral-edgetpu.list\n","\n","! sudo apt-get update\n","\n","! sudo apt-get install edgetpu-compiler"]},{"cell_type":"markdown","metadata":{"id":"Y3PL0wPgJpkL"},"source":["Download tools for generating datasets. Download images with labels from Open Images V6 as OIDv4 format and convert to VOC XML format."]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true,"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":2530,"status":"ok","timestamp":1660745221482,"user":{"displayName":"Jens Joachim Pedersen","userId":"12704241209616827899"},"user_tz":-120},"id":"J6FSdCCUJqmT"},"outputs":[{"name":"stdout","output_type":"stream","text":["Cloning into 'OIDv4_ToolKit'...\n","remote: Enumerating objects: 422, done.\u001b[K\n","remote: Total 422 (delta 0), reused 0 (delta 0), pack-reused 422\u001b[K\n","Receiving objects: 100% (422/422), 34.08 MiB | 23.71 MiB/s, done.\n","Resolving deltas: 100% (146/146), done.\n"]}],"source":["!git clone https://github.com/EscVM/OIDv4_ToolKit.git"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true,"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":11052,"status":"ok","timestamp":1660745232528,"user":{"displayName":"Jens Joachim Pedersen","userId":"12704241209616827899"},"user_tz":-120},"id":"NpAxLnPeJrAU"},"outputs":[{"name":"stdout","output_type":"stream","text":["Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Requirement already satisfied: pandas in /usr/local/lib/python3.7/dist-packages (from -r OIDv4_ToolKit/requirements.txt (line 1)) (1.3.5)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from -r OIDv4_ToolKit/requirements.txt (line 2)) (1.21.6)\n","Collecting awscli\n","  Downloading awscli-1.25.55-py3-none-any.whl (3.9 MB)\n","\u001b[K     |████████████████████████████████| 3.9 MB 12.3 MB/s \n","\u001b[?25hRequirement already satisfied: urllib3 in /usr/local/lib/python3.7/dist-packages (from -r OIDv4_ToolKit/requirements.txt (line 5)) (1.24.3)\n","Requirement already satisfied: tqdm in /usr/local/lib/python3.7/dist-packages (from -r OIDv4_ToolKit/requirements.txt (line 7)) (4.64.0)\n","Requirement already satisfied: opencv-python in /usr/local/lib/python3.7/dist-packages (from -r OIDv4_ToolKit/requirements.txt (line 9)) (4.6.0.66)\n","Requirement already satisfied: pytz\u003e=2017.3 in /usr/local/lib/python3.7/dist-packages (from pandas-\u003e-r OIDv4_ToolKit/requirements.txt (line 1)) (2022.2)\n","Requirement already satisfied: python-dateutil\u003e=2.7.3 in /usr/local/lib/python3.7/dist-packages (from pandas-\u003e-r OIDv4_ToolKit/requirements.txt (line 1)) (2.8.2)\n","Requirement already satisfied: six\u003e=1.5 in /usr/local/lib/python3.7/dist-packages (from python-dateutil\u003e=2.7.3-\u003epandas-\u003e-r OIDv4_ToolKit/requirements.txt (line 1)) (1.15.0)\n","Collecting PyYAML\u003c5.5,\u003e=3.10\n","  Downloading PyYAML-5.4.1-cp37-cp37m-manylinux1_x86_64.whl (636 kB)\n","\u001b[K     |████████████████████████████████| 636 kB 64.4 MB/s \n","\u001b[?25hCollecting rsa\u003c4.8,\u003e=3.1.2\n","  Downloading rsa-4.7.2-py3-none-any.whl (34 kB)\n","Collecting s3transfer\u003c0.7.0,\u003e=0.6.0\n","  Downloading s3transfer-0.6.0-py3-none-any.whl (79 kB)\n","\u001b[K     |████████████████████████████████| 79 kB 7.8 MB/s \n","\u001b[?25hCollecting docutils\u003c0.17,\u003e=0.10\n","  Downloading docutils-0.16-py2.py3-none-any.whl (548 kB)\n","\u001b[K     |████████████████████████████████| 548 kB 49.5 MB/s \n","\u001b[?25hCollecting colorama\u003c0.4.5,\u003e=0.2.5\n","  Downloading colorama-0.4.4-py2.py3-none-any.whl (16 kB)\n","Collecting botocore==1.27.54\n","  Downloading botocore-1.27.54-py3-none-any.whl (9.1 MB)\n","\u001b[K     |████████████████████████████████| 9.1 MB 58.3 MB/s \n","\u001b[?25hCollecting urllib3\n","  Downloading urllib3-1.26.11-py2.py3-none-any.whl (139 kB)\n","\u001b[K     |████████████████████████████████| 139 kB 64.0 MB/s \n","\u001b[?25hCollecting jmespath\u003c2.0.0,\u003e=0.7.1\n","  Downloading jmespath-1.0.1-py3-none-any.whl (20 kB)\n","Requirement already satisfied: pyasn1\u003e=0.1.3 in /usr/local/lib/python3.7/dist-packages (from rsa\u003c4.8,\u003e=3.1.2-\u003eawscli-\u003e-r OIDv4_ToolKit/requirements.txt (line 3)) (0.4.8)\n","Installing collected packages: urllib3, jmespath, botocore, s3transfer, rsa, PyYAML, docutils, colorama, awscli\n","  Attempting uninstall: urllib3\n","    Found existing installation: urllib3 1.24.3\n","    Uninstalling urllib3-1.24.3:\n","      Successfully uninstalled urllib3-1.24.3\n","  Attempting uninstall: rsa\n","    Found existing installation: rsa 4.9\n","    Uninstalling rsa-4.9:\n","      Successfully uninstalled rsa-4.9\n","  Attempting uninstall: PyYAML\n","    Found existing installation: PyYAML 6.0\n","    Uninstalling PyYAML-6.0:\n","      Successfully uninstalled PyYAML-6.0\n","  Attempting uninstall: docutils\n","    Found existing installation: docutils 0.17.1\n","    Uninstalling docutils-0.17.1:\n","      Successfully uninstalled docutils-0.17.1\n","\u001b[31mERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.\n","tflite-model-maker 0.4.1 requires flatbuffers==1.12, but you have flatbuffers 2.0 which is incompatible.\n","tflite-model-maker 0.4.1 requires urllib3!=1.25.0,!=1.25.1,\u003c1.26,\u003e=1.21.1, but you have urllib3 1.26.11 which is incompatible.\n","requests 2.23.0 requires urllib3!=1.25.0,!=1.25.1,\u003c1.26,\u003e=1.21.1, but you have urllib3 1.26.11 which is incompatible.\u001b[0m\n","Successfully installed PyYAML-5.4.1 awscli-1.25.55 botocore-1.27.54 colorama-0.4.4 docutils-0.16 jmespath-1.0.1 rsa-4.7.2 s3transfer-0.6.0 urllib3-1.26.11\n"]}],"source":["!pip install -r OIDv4_ToolKit/requirements.txt"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true,"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":903,"status":"ok","timestamp":1660745233427,"user":{"displayName":"Jens Joachim Pedersen","userId":"12704241209616827899"},"user_tz":-120},"id":"d_1jOw29JrTr"},"outputs":[{"name":"stdout","output_type":"stream","text":["Cloning into 'OIDv4_to_VOC'...\n","remote: Enumerating objects: 26, done.\u001b[K\n","remote: Counting objects: 100% (8/8), done.\u001b[K\n","remote: Total 26 (delta 7), reused 7 (delta 7), pack-reused 18\u001b[K\n","Unpacking objects: 100% (26/26), done.\n"]}],"source":["!git clone https://github.com/AtriSaxena/OIDv4_to_VOC.git"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true,"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":3503,"status":"ok","timestamp":1660745236927,"user":{"displayName":"Jens Joachim Pedersen","userId":"12704241209616827899"},"user_tz":-120},"id":"LIBzj6IFJrtt"},"outputs":[{"name":"stdout","output_type":"stream","text":["Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Requirement already satisfied: opencv-python in /usr/local/lib/python3.7/dist-packages (from -r OIDv4_to_VOC/requirements.txt (line 1)) (4.6.0.66)\n","Requirement already satisfied: pathlib in /usr/local/lib/python3.7/dist-packages (from -r OIDv4_to_VOC/requirements.txt (line 2)) (1.0.1)\n","Collecting argparse\n","  Downloading argparse-1.4.0-py2.py3-none-any.whl (23 kB)\n","Requirement already satisfied: numpy\u003e=1.14.5 in /usr/local/lib/python3.7/dist-packages (from opencv-python-\u003e-r OIDv4_to_VOC/requirements.txt (line 1)) (1.21.6)\n","Installing collected packages: argparse\n","Successfully installed argparse-1.4.0\n"]},{"data":{"application/vnd.colab-display-data+json":{"pip_warning":{"packages":["argparse"]}}},"metadata":{},"output_type":"display_data"}],"source":["!pip install -r OIDv4_to_VOC/requirements.txt"]},{"cell_type":"markdown","metadata":{"id":"l6lRhVK9Q_0U"},"source":["Import the required packages."]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true,"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":4654,"status":"ok","timestamp":1660745241576,"user":{"displayName":"Jens Joachim Pedersen","userId":"12704241209616827899"},"user_tz":-120},"id":"XtxiUeZEiXpt"},"outputs":[{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.7/dist-packages/requests/__init__.py:91: RequestsDependencyWarning: urllib3 (1.26.11) or chardet (3.0.4) doesn't match a supported version!\n","  RequestsDependencyWarning)\n"]}],"source":["import numpy as np\n","import os\n","\n","from tflite_model_maker.config import QuantizationConfig\n","from tflite_model_maker.config import ExportFormat\n","from tflite_model_maker import model_spec\n","from tflite_model_maker import object_detector\n","\n","import tensorflow as tf\n","assert tf.__version__.startswith('2')\n","\n","tf.get_logger().setLevel('ERROR')\n","from absl import logging\n","logging.set_verbosity(logging.ERROR)"]},{"cell_type":"markdown","metadata":{"id":"BRd13bfetO7B"},"source":["### Prepare the dataset"]},{"cell_type":"markdown","metadata":{"id":"vs3JWvLfOgow"},"source":["Generate dataset from Open Images Dataset V6"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"Zw1VZCfISoh-"},"outputs":[],"source":["import math\n","from datetime import datetime\n","import pytz\n","tz = pytz.timezone('Europe/Berlin')\n","now = datetime.now(tz)\n","#dt_string = now.strftime(\"%d_%m_%Y__%H_%M\")\n","dt_string = now.strftime(\"%d_%m_%Y\")"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true,"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":8,"status":"ok","timestamp":1660745241577,"user":{"displayName":"Jens Joachim Pedersen","userId":"12704241209616827899"},"user_tz":-120},"id":"AO_FG8cpPhxi"},"outputs":[{"name":"stdout","output_type":"stream","text":["class_input:\n","['Person', 'Dog', 'Cat', 'Human head', 'Deer', 'Squirrel', 'Bird']\n","class_input_no_space:\n","['Person', 'Dog', 'Cat', 'Human_head', 'Deer', 'Squirrel', 'Bird']\n","class_input_str:\n","Person Dog Cat Human_head Deer Squirrel Bird\n","Images per class to be downloaded:\n","train_per_class:      2000\n","validation_per_class: 250\n","test_per_class:       250\n"]}],"source":["class_input_no_space = []\n","for cl_in in class_input:\n","  class_input_no_space.append(cl_in.replace(' ', '_', 1000))\n","class_input_str = \" \".join(class_input_no_space)\n","\n","print('class_input:')\n","print(class_input)\n","print('class_input_no_space:')\n","print(class_input_no_space)\n","print('class_input_str:')\n","print(class_input_str)\n","\n","validation_per_class = math.ceil(train_per_class/8)\n","test_per_class       = math.ceil(train_per_class/8)\n","print('Images per class to be downloaded:')\n","print('train_per_class:      '+str(train_per_class))\n","print('validation_per_class: '+str(validation_per_class))\n","print('test_per_class:       '+str(test_per_class))"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"4hL0u4rMOpcs"},"outputs":[],"source":["path = 'OID/Dataset'\n","if os.path.exists(path):\n","  if os.name == 'posix':\n","    !rm -fr {path}\n","  if os.name == 'nt':\n","    !rm -fr {path}"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true,"base_uri":"https://localhost:8080/"},"id":"7BvmOxjUO_0p"},"outputs":[{"name":"stdout","output_type":"stream","text":["\u001b[92m\n","\t\t   ___   _____  ______            _    _    \n","\t\t .'   `.|_   _||_   _ `.         | |  | |   \n","\t\t/  .-.  \\ | |    | | `. \\ _   __ | |__| |_  \n","\t\t| |   | | | |    | |  | |[ \\ [  ]|____   _| \n","\t\t\\  `-'  /_| |_  _| |_.' / \\ \\/ /     _| |_  \n","\t\t `.___.'|_____||______.'   \\__/     |_____|\n","\t\u001b[0m\n","\u001b[92m\n","             _____                    _                 _             \n","            (____ \\                  | |               | |            \n","             _   \\ \\ ___  _ _ _ ____ | | ___   ____  _ | | ____  ____ \n","            | |   | / _ \\| | | |  _ \\| |/ _ \\ / _  |/ || |/ _  )/ ___)\n","            | |__/ / |_| | | | | | | | | |_| ( ( | ( (_| ( (/ /| |    \n","            |_____/ \\___/ \\____|_| |_|_|\\___/ \\_||_|\\____|\\____)_|    \n","                                                          \n","        \u001b[0m\n","    [INFO] | Downloading Person.\u001b[0m\n","\u001b[91m   [ERROR] | Missing the class-descriptions-boxable.csv file.\u001b[0m\n","\u001b[94m[DOWNLOAD] | Automatic download.\u001b[0m\n","...145%, 0 MB, 12721 KB/s, 0 seconds passed\n","\u001b[94m[DOWNLOAD] | File class-descriptions-boxable.csv downloaded into OID/csv_folder/class-descriptions-boxable.csv.\u001b[0m\n","\u001b[91m   [ERROR] | Missing the train-annotations-bbox.csv file.\u001b[0m\n","\u001b[94m[DOWNLOAD] | Automatic download.\u001b[0m\n","...100%, 1138 MB, 52366 KB/s, 22 seconds passed\n","\u001b[94m[DOWNLOAD] | File train-annotations-bbox.csv downloaded into OID/csv_folder/train-annotations-bbox.csv.\u001b[0m\n","\n","\u001b[95mPerson\u001b[0m\n","    [INFO] | Downloading train images.\u001b[0m\n","    [INFO] | [INFO] Found 248384 online images for train.\u001b[0m\n","    [INFO] | Limiting to 2000 images.\u001b[0m\n","    [INFO] | Download of 2000 images in train.\u001b[0m\n","100% 2000/2000 [04:02\u003c00:00,  8.23it/s]\n","    [INFO] | Done!\u001b[0m\n","    [INFO] | Creating labels for Person of train.\u001b[0m\n","    [INFO] | Labels creation completed.\u001b[0m\n","    [INFO] | Downloading Dog.\u001b[0m\n","\n","\u001b[95mDog\u001b[0m\n","    [INFO] | Downloading train images.\u001b[0m\n","    [INFO] | [INFO] Found 20607 online images for train.\u001b[0m\n","    [INFO] | Limiting to 2000 images.\u001b[0m\n","    [INFO] | Download of 2000 images in train.\u001b[0m\n","100% 2000/2000 [04:13\u003c00:00,  7.88it/s]\n","    [INFO] | Done!\u001b[0m\n","    [INFO] | Creating labels for Dog of train.\u001b[0m\n","    [INFO] | Labels creation completed.\u001b[0m\n","    [INFO] | Downloading Cat.\u001b[0m\n","\n","\u001b[95mCat\u001b[0m\n","    [INFO] | Downloading train images.\u001b[0m\n","    [INFO] | [INFO] Found 12516 online images for train.\u001b[0m\n","    [INFO] | Limiting to 2000 images.\u001b[0m\n","    [INFO] | Download of 2000 images in train.\u001b[0m\n","100% 2000/2000 [04:22\u003c00:00,  7.62it/s]\n","    [INFO] | Done!\u001b[0m\n","    [INFO] | Creating labels for Cat of train.\u001b[0m\n","    [INFO] | Labels creation completed.\u001b[0m\n","    [INFO] | Downloading Human head.\u001b[0m\n","\n","\u001b[95mHuman head\u001b[0m\n","    [INFO] | Downloading train images.\u001b[0m\n","    [INFO] | [INFO] Found 49308 online images for train.\u001b[0m\n","    [INFO] | Limiting to 2000 images.\u001b[0m\n","    [INFO] | Download of 2000 images in train.\u001b[0m\n","100% 2000/2000 [04:29\u003c00:00,  7.42it/s]\n","    [INFO] | Done!\u001b[0m\n","    [INFO] | Creating labels for Human head of train.\u001b[0m\n","    [INFO] | Labels creation completed.\u001b[0m\n","    [INFO] | Downloading Deer.\u001b[0m\n","\n","\u001b[95mDeer\u001b[0m\n","    [INFO] | Downloading train images.\u001b[0m\n","    [INFO] | [INFO] Found 2093 online images for train.\u001b[0m\n","    [INFO] | Limiting to 2000 images.\u001b[0m\n","    [INFO] | Download of 2000 images in train.\u001b[0m\n","100% 2000/2000 [04:29\u003c00:00,  7.41it/s]\n","    [INFO] | Done!\u001b[0m\n","    [INFO] | Creating labels for Deer of train.\u001b[0m\n","    [INFO] | Labels creation completed.\u001b[0m\n","    [INFO] | Downloading Squirrel.\u001b[0m\n","\n","\u001b[95mSquirrel\u001b[0m\n","    [INFO] | Downloading train images.\u001b[0m\n","    [INFO] | [INFO] Found 1810 online images for train.\u001b[0m\n","    [INFO] | Limiting to 2000 images.\u001b[0m\n","    [INFO] | Download of 1810 images in train.\u001b[0m\n","100% 1810/1810 [04:04\u003c00:00,  7.39it/s]\n","    [INFO] | Done!\u001b[0m\n","    [INFO] | Creating labels for Squirrel of train.\u001b[0m\n","    [INFO] | Labels creation completed.\u001b[0m\n","    [INFO] | Downloading Bird.\u001b[0m\n","\n","\u001b[95mBird\u001b[0m\n","    [INFO] | Downloading train images.\u001b[0m\n","    [INFO] | [INFO] Found 18525 online images for train.\u001b[0m\n","    [INFO] | Limiting to 2000 images.\u001b[0m\n","    [INFO] | Download of 2000 images in train.\u001b[0m\n","100% 2000/2000 [04:30\u003c00:00,  7.41it/s]\n","    [INFO] | Done!\u001b[0m\n","    [INFO] | Creating labels for Bird of train.\u001b[0m\n","    [INFO] | Labels creation completed.\u001b[0m\n"]}],"source":["!python OIDv4_ToolKit/main.py downloader -y --classes {class_input_str} --type_csv train --limit {train_per_class}"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"Wrx9EAEuTazk"},"outputs":[{"name":"stdout","output_type":"stream","text":["\u001b[92m\n","\t\t   ___   _____  ______            _    _    \n","\t\t .'   `.|_   _||_   _ `.         | |  | |   \n","\t\t/  .-.  \\ | |    | | `. \\ _   __ | |__| |_  \n","\t\t| |   | | | |    | |  | |[ \\ [  ]|____   _| \n","\t\t\\  `-'  /_| |_  _| |_.' / \\ \\/ /     _| |_  \n","\t\t `.___.'|_____||______.'   \\__/     |_____|\n","\t\u001b[0m\n","\u001b[92m\n","             _____                    _                 _             \n","            (____ \\                  | |               | |            \n","             _   \\ \\ ___  _ _ _ ____ | | ___   ____  _ | | ____  ____ \n","            | |   | / _ \\| | | |  _ \\| |/ _ \\ / _  |/ || |/ _  )/ ___)\n","            | |__/ / |_| | | | | | | | | |_| ( ( | ( (_| ( (/ /| |    \n","            |_____/ \\___/ \\____|_| |_|_|\\___/ \\_||_|\\____|\\____)_|    \n","                                                          \n","        \u001b[0m\n","    [INFO] | Downloading Person.\u001b[0m\n","\u001b[91m   [ERROR] | Missing the validation-annotations-bbox.csv file.\u001b[0m\n","\u001b[94m[DOWNLOAD] | Automatic download.\u001b[0m\n","...100%, 16 MB, 22077 KB/s, 0 seconds passed\n","\u001b[94m[DOWNLOAD] | File validation-annotations-bbox.csv downloaded into OID/csv_folder/validation-annotations-bbox.csv.\u001b[0m\n","\n","\u001b[95mPerson\u001b[0m\n","    [INFO] | Downloading validation images.\u001b[0m\n","    [INFO] | [INFO] Found 6436 online images for validation.\u001b[0m\n","    [INFO] | Limiting to 250 images.\u001b[0m\n","    [INFO] | Download of 250 images in validation.\u001b[0m\n","100% 250/250 [00:31\u003c00:00,  7.89it/s]\n","    [INFO] | Done!\u001b[0m\n","    [INFO] | Creating labels for Person of validation.\u001b[0m\n","    [INFO] | Labels creation completed.\u001b[0m\n","    [INFO] | Downloading Dog.\u001b[0m\n","\n","\u001b[95mDog\u001b[0m\n","    [INFO] | Downloading validation images.\u001b[0m\n","    [INFO] | [INFO] Found 1581 online images for validation.\u001b[0m\n","    [INFO] | Limiting to 250 images.\u001b[0m\n","    [INFO] | Download of 250 images in validation.\u001b[0m\n","100% 250/250 [00:31\u003c00:00,  8.06it/s]\n","    [INFO] | Done!\u001b[0m\n","    [INFO] | Creating labels for Dog of validation.\u001b[0m\n","    [INFO] | Labels creation completed.\u001b[0m\n","    [INFO] | Downloading Cat.\u001b[0m\n","\n","\u001b[95mCat\u001b[0m\n","    [INFO] | Downloading validation images.\u001b[0m\n","    [INFO] | [INFO] Found 337 online images for validation.\u001b[0m\n","    [INFO] | Limiting to 250 images.\u001b[0m\n","    [INFO] | Download of 250 images in validation.\u001b[0m\n","100% 250/250 [00:30\u003c00:00,  8.07it/s]\n","    [INFO] | Done!\u001b[0m\n","    [INFO] | Creating labels for Cat of validation.\u001b[0m\n","    [INFO] | Labels creation completed.\u001b[0m\n","    [INFO] | Downloading Human head.\u001b[0m\n","\n","\u001b[95mHuman head\u001b[0m\n","    [INFO] | Downloading validation images.\u001b[0m\n","    [INFO] | [INFO] Found 3271 online images for validation.\u001b[0m\n","    [INFO] | Limiting to 250 images.\u001b[0m\n","    [INFO] | Download of 250 images in validation.\u001b[0m\n","100% 250/250 [00:31\u003c00:00,  8.04it/s]\n","    [INFO] | Done!\u001b[0m\n","    [INFO] | Creating labels for Human head of validation.\u001b[0m\n","    [INFO] | Labels creation completed.\u001b[0m\n","    [INFO] | Downloading Deer.\u001b[0m\n","\n","\u001b[95mDeer\u001b[0m\n","    [INFO] | Downloading validation images.\u001b[0m\n","    [INFO] | [INFO] Found 83 online images for validation.\u001b[0m\n","    [INFO] | Limiting to 250 images.\u001b[0m\n","    [INFO] | Download of 83 images in validation.\u001b[0m\n","100% 83/83 [00:11\u003c00:00,  7.20it/s]\n","    [INFO] | Done!\u001b[0m\n","    [INFO] | Creating labels for Deer of validation.\u001b[0m\n","    [INFO] | Labels creation completed.\u001b[0m\n","    [INFO] | Downloading Squirrel.\u001b[0m\n","\n","\u001b[95mSquirrel\u001b[0m\n","    [INFO] | Downloading validation images.\u001b[0m\n","    [INFO] | [INFO] Found 39 online images for validation.\u001b[0m\n","    [INFO] | Limiting to 250 images.\u001b[0m\n","    [INFO] | Download of 39 images in validation.\u001b[0m\n","100% 39/39 [00:05\u003c00:00,  6.56it/s]\n","    [INFO] | Done!\u001b[0m\n","    [INFO] | Creating labels for Squirrel of validation.\u001b[0m\n","    [INFO] | Labels creation completed.\u001b[0m\n","    [INFO] | Downloading Bird.\u001b[0m\n","\n","\u001b[95mBird\u001b[0m\n","    [INFO] | Downloading validation images.\u001b[0m\n","    [INFO] | [INFO] Found 652 online images for validation.\u001b[0m\n","    [INFO] | Limiting to 250 images.\u001b[0m\n","    [INFO] | Download of 250 images in validation.\u001b[0m\n","100% 250/250 [00:31\u003c00:00,  7.97it/s]\n","    [INFO] | Done!\u001b[0m\n","    [INFO] | Creating labels for Bird of validation.\u001b[0m\n","    [INFO] | Labels creation completed.\u001b[0m\n"]}],"source":["!python OIDv4_ToolKit/main.py downloader -y --classes {class_input_str} --type_csv validation --limit {validation_per_class}"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"VoXr8GvsTmL_"},"outputs":[{"name":"stdout","output_type":"stream","text":["\u001b[92m\n","\t\t   ___   _____  ______            _    _    \n","\t\t .'   `.|_   _||_   _ `.         | |  | |   \n","\t\t/  .-.  \\ | |    | | `. \\ _   __ | |__| |_  \n","\t\t| |   | | | |    | |  | |[ \\ [  ]|____   _| \n","\t\t\\  `-'  /_| |_  _| |_.' / \\ \\/ /     _| |_  \n","\t\t `.___.'|_____||______.'   \\__/     |_____|\n","\t\u001b[0m\n","\u001b[92m\n","             _____                    _                 _             \n","            (____ \\                  | |               | |            \n","             _   \\ \\ ___  _ _ _ ____ | | ___   ____  _ | | ____  ____ \n","            | |   | / _ \\| | | |  _ \\| |/ _ \\ / _  |/ || |/ _  )/ ___)\n","            | |__/ / |_| | | | | | | | | |_| ( ( | ( (_| ( (/ /| |    \n","            |_____/ \\___/ \\____|_| |_|_|\\___/ \\_||_|\\____|\\____)_|    \n","                                                          \n","        \u001b[0m\n","    [INFO] | Downloading Person.\u001b[0m\n","\u001b[91m   [ERROR] | Missing the test-annotations-bbox.csv file.\u001b[0m\n","\u001b[94m[DOWNLOAD] | Automatic download.\u001b[0m\n","...100%, 49 MB, 30680 KB/s, 1 seconds passed\n","\u001b[94m[DOWNLOAD] | File test-annotations-bbox.csv downloaded into OID/csv_folder/test-annotations-bbox.csv.\u001b[0m\n","\n","\u001b[95mPerson\u001b[0m\n","    [INFO] | Downloading test images.\u001b[0m\n","    [INFO] | [INFO] Found 19418 online images for test.\u001b[0m\n","    [INFO] | Limiting to 250 images.\u001b[0m\n","    [INFO] | Download of 250 images in test.\u001b[0m\n","100% 250/250 [00:31\u003c00:00,  8.04it/s]\n","    [INFO] | Done!\u001b[0m\n","    [INFO] | Creating labels for Person of test.\u001b[0m\n","    [INFO] | Labels creation completed.\u001b[0m\n","    [INFO] | Downloading Dog.\u001b[0m\n","\n","\u001b[95mDog\u001b[0m\n","    [INFO] | Downloading test images.\u001b[0m\n","    [INFO] | [INFO] Found 4810 online images for test.\u001b[0m\n","    [INFO] | Limiting to 250 images.\u001b[0m\n","    [INFO] | Download of 250 images in test.\u001b[0m\n","100% 250/250 [00:30\u003c00:00,  8.20it/s]\n","    [INFO] | Done!\u001b[0m\n","    [INFO] | Creating labels for Dog of test.\u001b[0m\n","    [INFO] | Labels creation completed.\u001b[0m\n","    [INFO] | Downloading Cat.\u001b[0m\n","\n","\u001b[95mCat\u001b[0m\n","    [INFO] | Downloading test images.\u001b[0m\n","    [INFO] | [INFO] Found 982 online images for test.\u001b[0m\n","    [INFO] | Limiting to 250 images.\u001b[0m\n","    [INFO] | Download of 250 images in test.\u001b[0m\n","100% 250/250 [00:31\u003c00:00,  8.03it/s]\n","    [INFO] | Done!\u001b[0m\n","    [INFO] | Creating labels for Cat of test.\u001b[0m\n","    [INFO] | Labels creation completed.\u001b[0m\n","    [INFO] | Downloading Human head.\u001b[0m\n","\n","\u001b[95mHuman head\u001b[0m\n","    [INFO] | Downloading test images.\u001b[0m\n","    [INFO] | [INFO] Found 9945 online images for test.\u001b[0m\n","    [INFO] | Limiting to 250 images.\u001b[0m\n","    [INFO] | Download of 250 images in test.\u001b[0m\n","100% 250/250 [00:31\u003c00:00,  8.04it/s]\n","    [INFO] | Done!\u001b[0m\n","    [INFO] | Creating labels for Human head of test.\u001b[0m\n","    [INFO] | Labels creation completed.\u001b[0m\n","    [INFO] | Downloading Deer.\u001b[0m\n","\n","\u001b[95mDeer\u001b[0m\n","    [INFO] | Downloading test images.\u001b[0m\n","    [INFO] | [INFO] Found 280 online images for test.\u001b[0m\n","    [INFO] | Limiting to 250 images.\u001b[0m\n","    [INFO] | Download of 250 images in test.\u001b[0m\n","100% 250/250 [00:30\u003c00:00,  8.14it/s]\n","    [INFO] | Done!\u001b[0m\n","    [INFO] | Creating labels for Deer of test.\u001b[0m\n","    [INFO] | Labels creation completed.\u001b[0m\n","    [INFO] | Downloading Squirrel.\u001b[0m\n","\n","\u001b[95mSquirrel\u001b[0m\n","    [INFO] | Downloading test images.\u001b[0m\n","    [INFO] | [INFO] Found 90 online images for test.\u001b[0m\n","    [INFO] | Limiting to 250 images.\u001b[0m\n","    [INFO] | Download of 90 images in test.\u001b[0m\n","100% 90/90 [00:12\u003c00:00,  7.40it/s]\n","    [INFO] | Done!\u001b[0m\n","    [INFO] | Creating labels for Squirrel of test.\u001b[0m\n","    [INFO] | Labels creation completed.\u001b[0m\n","    [INFO] | Downloading Bird.\u001b[0m\n","\n","\u001b[95mBird\u001b[0m\n","    [INFO] | Downloading test images.\u001b[0m\n","    [INFO] | [INFO] Found 1997 online images for test.\u001b[0m\n","    [INFO] | Limiting to 250 images.\u001b[0m\n","    [INFO] | Download of 250 images in test.\u001b[0m\n","100% 250/250 [00:31\u003c00:00,  7.93it/s]\n","    [INFO] | Done!\u001b[0m\n","    [INFO] | Creating labels for Bird of test.\u001b[0m\n","    [INFO] | Labels creation completed.\u001b[0m\n"]}],"source":["!python OIDv4_ToolKit/main.py downloader -y --classes {class_input_str} --type_csv test --limit {test_per_class}"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"-Ieu_uxttrF0"},"outputs":[{"name":"stdout","output_type":"stream","text":["OID/Dataset/train/Human_head\n","print: OID/Dataset/train/Human_head\n","OID/Dataset/validation/Human_head\n","print: OID/Dataset/validation/Human_head\n","OID/Dataset/test/Human_head\n","print: OID/Dataset/test/Human_head\n"]}],"source":["# Remove space\n","for train_val_test_str in ['train', 'validation', 'test']:\n","  for cl in class_input:\n","    cl_new = cl.replace(' ', '_', 1000)\n","    if ' ' in cl:\n","      # Delete if exists\n","      path = os.path.join('OID', 'Dataset', train_val_test_str, cl_new)\n","      print(path)\n","      if os.path.exists(path):\n","        if os.name == 'posix':\n","          !rm -fr {path}\n","        if os.name == 'nt':\n","          !rm -fr {path}\n","      # Rename/move\n","      %mv OID/Dataset/{train_val_test_str}/{cl.replace(' ', '\\ ', 1000)} OID/Dataset/{train_val_test_str}/{cl_new}\n","      # Find all files and replace\n","      print('print: '+path)\n","      !find OID${path}/Label/*.txt \u003e label_files.txt\n","      file1 = open('label_files.txt', 'r')\n","      Lines = file1.readlines()\n","      for line in Lines:\n","        !sed -i 's/'{cl.replace(' ', '\\ ', 1000)}'/'{cl_new}'/g' {line.strip()}\n","      %rm label_files.txt\n","  "]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"DFjGhVeJK03m"},"outputs":[{"name":"stdout","output_type":"stream","text":["train          Person         2000\n","train          Dog            2000\n","train          Cat            2000\n","train          Human_head     2000\n","train          Deer           2000\n","train          Squirrel       1810\n","train          Bird           2000\n","validation     Person         250\n","validation     Dog            250\n","validation     Cat            250\n","validation     Human_head     250\n","validation     Deer           83\n","validation     Squirrel       39\n","validation     Bird           250\n","test           Person         250\n","test           Dog            250\n","test           Cat            250\n","test           Human_head     250\n","test           Deer           250\n","test           Squirrel       90\n","test           Bird           250\n"]}],"source":["# Count dataset size\n","file_name_labels_dataset = 'labels_dataset.txt'\n","!rm -f file_name_labels_dataset\n","f = open(file_name_labels_dataset, 'w')\n","for train_val_test_str in ['train', 'validation', 'test']:\n","  for cl in class_input_no_space:\n","    labels_in_dir = !ls OID/Dataset/{train_val_test_str}/{cl}/Label | wc -l\n","    labels_in_dir_str = ''+train_val_test_str.ljust(15)+cl.ljust(15)+str(labels_in_dir[0])\n","    print(labels_in_dir_str)\n","    f.write(labels_in_dir_str+'\\n')\n","f.close()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"hk5U7wW0tB9R"},"outputs":[],"source":["path = 'VOC'\n","if os.path.exists(path):\n","  if os.name == 'posix':\n","    !rm -fr {path}\n","  if os.name == 'nt':\n","    !rm -fr {path}\n","\n","if os.name == 'posix':\n","    !mkdir -p {path}\n","    !mkdir -p {os.path.join(path, 'train_annotation')}\n","    !mkdir -p {os.path.join(path, 'train')}\n","    !mkdir -p {os.path.join(path, 'validation_annotation')}\n","    !mkdir -p {os.path.join(path, 'validation')}\n","    !mkdir -p {os.path.join(path, 'test_annotation')}\n","    !mkdir -p {os.path.join(path, 'test')}\n","if os.name == 'nt':\n","    !mkdir {path}\n","    !mkdir {os.path.join(path, 'train_annotation')}\n","    !mkdir {os.path.join(path, 'train')}\n","    !mkdir {os.path.join(path, 'validation_annotation')}\n","    !mkdir {os.path.join(path, 'validation')}\n","    !mkdir {os.path.join(path, 'test_annotation')}\n","    !mkdir {os.path.join(path, 'test')}"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"uYOcerWJUnOm"},"outputs":[],"source":["for train_val_test_str in ['train', 'validation', 'test']:\n","  for cl in class_input_no_space:\n","    %cp OID/Dataset/{train_val_test_str}/{cl}/*.jpg VOC/{train_val_test_str}/\n","    !python OIDv4_to_VOC/OIDv4_to_VOC.py --sourcepath OID/Dataset/{train_val_test_str}/{cl} --dest_path VOC/{train_val_test_str}_annotation\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"-ZtokPBPAo-E"},"outputs":[{"name":"stdout","output_type":"stream","text":["13675\n","1338\n","1530\n"]}],"source":["train_data      = object_detector.DataLoader.from_pascal_voc('/content/VOC/train',      '/content/VOC/train_annotation',      label_map=class_input_no_space)\n","validation_data = object_detector.DataLoader.from_pascal_voc('/content/VOC/validation', '/content/VOC/validation_annotation', label_map=class_input_no_space)\n","test_data       = object_detector.DataLoader.from_pascal_voc('/content/VOC/test',       '/content/VOC/test_annotation',       label_map=class_input_no_space)\n","print(train_data.size)\n","print(validation_data.size)\n","print(test_data.size)"]},{"cell_type":"markdown","metadata":{"id":"n6felmN6aETP"},"source":["Function for storing evaluation results"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"hpSpOFAVA8EX"},"outputs":[],"source":["def store_eval_result(eval_text,file_name):\n","  !rm -f file_name\n","  f = open(file_name, 'w')\n","  for key, value in eval_text.items():\n","    new_string = ''+str(key.ljust(15))+' : '+str(value)\n","    print(new_string)\n","    f.write(new_string+'\\n')\n","  f.close()"]},{"cell_type":"markdown","metadata":{"id":"vn61LJ9QbOPi"},"source":["\n","**Choose an object detection model archiecture.**\n","\n","This tutorial uses the EfficientDet-Lite0 model. EfficientDet-Lite[0-4] are a family of mobile/IoT-friendly object detection models derived from the [EfficientDet](https://arxiv.org/abs/1911.09070) architecture.\n","\n","Here is the performance of each EfficientDet-Lite models compared to each others.\n","\n","| Model architecture | Size(MB)* | Latency(ms)** | Average Precision*** |\n","|--------------------|-----------|---------------|----------------------|\n","| EfficientDet-Lite0 | 4.4       | 37            | 25.69%               |\n","| EfficientDet-Lite1 | 5.8       | 49            | 30.55%               |\n","| EfficientDet-Lite2 | 7.2       | 69            | 33.97%               |\n","| EfficientDet-Lite3 | 11.4      | 116           | 37.70%               |\n","| EfficientDet-Lite4 | 19.9      | 260           | 41.96%               |\n","\n","\u003ci\u003e * Size of the integer quantized models. \u003cbr/\u003e\n","** Latency measured on Pixel 4 using 4 threads on CPU. \u003cbr/\u003e\n","*** Average Precision is the mAP (mean Average Precision) on the COCO 2017 validation dataset.\n","\u003c/i\u003e\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"CtdZ-JDwMimd"},"outputs":[],"source":["def make_spec_from_str(spec_str):\n","\n","  #spec_str = 'efficientdet_lite4'\n","  #spec = model_spec.get(spec_str)\n","  \n","  if spec_str == 'efficientdet-lite4':\n","    spec_str = 'efficientdet_lite4'\n","    spec = model_spec.get(spec_str)\n","    batch_size_in = 4\n","    print('Special Case')\n","  else:\n","    if spec_str == 'efficientdet-lite3':\n","      batch_size_in = 8\n","    elif spec_str == 'efficientdet-lite2':\n","      batch_size_in = 16\n","    else:\n","      batch_size_in = 32\n","    spec = object_detector.EfficientDetSpec(\n","      model_name=spec_str, \n","      uri='https://tfhub.dev/tensorflow/efficientdet/'+spec_str.split('-')[1]+'/feature-vector/1',\n","      tflite_max_detections = int(len(class_input)),\n","      hparams={'max_instances_per_image': 1000})\n","  print('model: '+spec_str)\n","  print('batch_size: '+str(batch_size_in))\n","\n","  return spec, batch_size_in"]},{"cell_type":"markdown","metadata":{"id":"FGkQZoM3dErd"},"source":["**Compile For the Edge TPU Function**\n","\n","The EdgeTPU has 8MB of SRAM for caching model paramaters ([more info](https://coral.ai/docs/edgetpu/compiler/#parameter-data-caching)). This means that for models that are larger than 8MB, inference time will be increased in order to transfer over model paramaters. One way to avoid this is [Model Pipelining](https://coral.ai/docs/edgetpu/pipeline/) - splitting the model into segments that can have a dedicated EdgeTPU. This can significantly improve latency.\n","\n","The below table can be used as a reference for the number of Edge TPUs to use - the larger models will not compile for a single TPU as the intermediate tensors can't fit in on-chip memory.\n","\n","| Model architecture | Minimum TPUs | Recommended TPUs\n","|--------------------|-------|-------|\n","| EfficientDet-Lite0 | 1     | 1     |\n","| EfficientDet-Lite1 | 1     | 1     |\n","| EfficientDet-Lite2 | 1     | 2     |\n","| EfficientDet-Lite3 | 2     | 2     |\n","| EfficientDet-Lite4 | 2     | 3     |"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"OYZ40Ba_drUp"},"outputs":[],"source":["def compile_edge_tpu(model_file_name):\n","  # Figure out file size split put partitions in less than 8MB\n","  model_file_size = !du {model_file_name}\n","  model_file_size = int(model_file_size[0].split('\\t')[0])\n","  number_of_tpus = int(math.floor(model_file_size/8000)+1)\n","  print('Com.piling for \\\"'+model_file_name+'\\\" for Edge TPU...')\n","  print('File size of '+str(model_file_size)+' bytes will give '+str(number_of_tpus)+' TPUs...')\n","  print('')\n","  print('edge_tpu_1')\n","  print('')\n","  !edgetpu_compiler {model_file_name} -d --out_dir \"edge_tpu_1\"\n","  print('')\n","  print('edge_tpu_2')\n","  print('')\n","  !edgetpu_compiler -s -i \"class_net/class-predict/BiasAdd;class_net/class-predict/separable_conv2d_4;class_net/class-predict/separable_conv2d;class_net/class-predict/bias\" {model_file_name} --out_dir \"edge_tpu_2\"\n","  print('')"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"yoI_MJYHec7i"},"outputs":[],"source":["#!rm -fr edge_tpu_1\n","#!mkdir edge_tpu_1\n","#!rm -fr edge_tpu_2\n","#!mkdir edge_tpu_2\n","#compile_edge_tpu('model_default.tflite')\n","#compile_edge_tpu('model_dynamic.tflite')\n","#compile_edge_tpu('model_float16.tflite')\n","#compile_edge_tpu('model_int8.tflite')"]},{"cell_type":"markdown","metadata":{"id":"gWGAUe0zdiR-"},"source":["**Run Model, Evaluation and store results**"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"kwlYdTcg63xy"},"outputs":[],"source":["def generate_model(spec_str,epochs_per_class):\n","\n","  # Get spec and batch size\n","  spec, batch_size_in = make_spec_from_str(spec_str)\n","  \n","  # Run model\n","  print('Running model...')\n","  model = object_detector.create(train_data, model_spec=spec, batch_size=batch_size_in, train_whole_model=True, validation_data=validation_data, epochs=epochs_per_class)\n","\n","  # Eval model\n","  print('Evaluating model...')\n","  eval_text = model.evaluate(test_data, batch_size=batch_size_in)\n","  store_eval_result(eval_text,'model_eval_result.txt')\n","\n","  # Export Labels\n","  model.export(export_dir='.', export_format=ExportFormat.LABEL)\n","  # Export Model\n","  model.export(export_dir='.', export_format=ExportFormat.SAVED_MODEL)\n","  # Export TFLITE\n","  model.export(export_dir='.', tflite_filename='model_default.tflite', export_format=ExportFormat.TFLITE)\n","  # Export TFLITE Dynamic\n","  model.export(export_dir='.', tflite_filename='model_dynamic.tflite', quantization_config=QuantizationConfig.for_dynamic())\n","  # Export TFLITE Float16\n","  model.export(export_dir='.', tflite_filename='model_float16.tflite', quantization_config=QuantizationConfig.for_float16())\n","  # Export TFLITE int8\n","  model.export(export_dir='.', tflite_filename='model_int8.tflite', quantization_config=QuantizationConfig.for_int8(test_data))\n"," \n","  # Eval TFLITE\n","  print('Evaluating tflite default...')\n","  eval_text = model.evaluate_tflite('model_default.tflite', test_data)\n","  store_eval_result(eval_text,'tflite_default_eval_result.txt')\n","  # Eval TFLITE Dynamic\n","  #print('Evaluating tflite dynamic...')\n","  #eval_text = model.evaluate_tflite('model_dynamic.tflite', test_data)\n","  #store_eval_result(eval_text,'tflite_dynamic_eval_result.txt')\n","  # Eval TFLITE Float16\n","  print('Evaluating tflite float16...')\n","  eval_text = model.evaluate_tflite('model_float16.tflite', test_data)\n","  store_eval_result(eval_text,'tflite_float16_eval_result.txt')\n","  # Eval TFLITE int8\n","  #print('Evaluating tflite int8...')\n","  #eval_text = model.evaluate_tflite('model_int8.tflite', test_data)\n","  #store_eval_result(eval_text,'tflite_int8_eval_result.txt')\n","\n","  # Compile for Edge TPU\n","  !rm -fr edge_tpu_1\n","  !mkdir edge_tpu_1\n","  !rm -fr edge_tpu_2\n","  !mkdir edge_tpu_2\n","  compile_edge_tpu('model_default.tflite')\n","  compile_edge_tpu('model_int8.tflite')\n","\n","  # Save on G-Drive\n","  print('Downloading to G-drive...')\n","  CUSTOM_MODEL_NAME = dt_string+'_'+spec_str+'_e'+str(epochs_per_class)+'_b'+str(batch_size_in)+'_s'+str(train_per_class)\n","  print(CUSTOM_MODEL_NAME)\n","  PATH_GDRIVE = '/content/drive/MyDrive/Mine\\ projekter/radar/tflite_custom_models'\n","  path = os.path.join(PATH_GDRIVE, CUSTOM_MODEL_NAME)\n","  # Remove if already present\n","  if not os.path.exists(path):\n","    !mkdir -p {path}\n","\n","  %cp labels.txt {path}\n","  \n","  %cp -r saved_model {path}\n","  %cp model_default.tflite {path}\n","  %cp model_dynamic.tflite {path}\n","  %cp model_float16.tflite {path}\n","  %cp model_int8.tflite {path}\n","  \n","  #%cp model_default_edgetpu* {path}\n","  #%cp model_int8_edgetpu* {path}\n","  %cp -r edge_tpu_1 {path}\n","  %cp -r edge_tpu_2 {path}\n","  \n","  %cp model_eval_result.txt {path}\n","  %cp tflite_default_eval_result.txt {path}\n","  #%cp tflite_dynamic_eval_result.txt {path}\n","  %cp tflite_float16_eval_result.txt {path}\n","  #%cp tflite_int8_eval_result.txt {path}\n","\n","  %cp {file_name_labels_dataset} {path}\n","\n","  return model"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"dkE_U6hJNyqy"},"outputs":[{"name":"stdout","output_type":"stream","text":["model: efficientdet-lite1\n","batch_size: 32\n","Running model...\n","Epoch 1/50\n","427/427 [==============================] - 449s 917ms/step - det_loss: 0.9732 - cls_loss: 0.6482 - box_loss: 0.0065 - reg_l2_loss: 0.0722 - loss: 1.0454 - learning_rate: 0.0240 - gradient_norm: 2.1778 - val_det_loss: 1.0669 - val_cls_loss: 0.7220 - val_box_loss: 0.0069 - val_reg_l2_loss: 0.0739 - val_loss: 1.1408\n","Epoch 2/50\n","427/427 [==============================] - 390s 913ms/step - det_loss: 0.7575 - cls_loss: 0.4921 - box_loss: 0.0053 - reg_l2_loss: 0.0760 - loss: 0.8334 - learning_rate: 0.0399 - gradient_norm: 1.9623 - val_det_loss: 0.7420 - val_cls_loss: 0.4757 - val_box_loss: 0.0053 - val_reg_l2_loss: 0.0777 - val_loss: 0.8197\n","Epoch 3/50\n","427/427 [==============================] - 390s 914ms/step - det_loss: 0.7110 - cls_loss: 0.4607 - box_loss: 0.0050 - reg_l2_loss: 0.0793 - loss: 0.7903 - learning_rate: 0.0397 - gradient_norm: 1.7827 - val_det_loss: 0.7661 - val_cls_loss: 0.5371 - val_box_loss: 0.0046 - val_reg_l2_loss: 0.0806 - val_loss: 0.8467\n","Epoch 4/50\n","427/427 [==============================] - 390s 914ms/step - det_loss: 0.6748 - cls_loss: 0.4390 - box_loss: 0.0047 - reg_l2_loss: 0.0819 - loss: 0.7568 - learning_rate: 0.0395 - gradient_norm: 1.6957 - val_det_loss: 0.6801 - val_cls_loss: 0.4397 - val_box_loss: 0.0048 - val_reg_l2_loss: 0.0831 - val_loss: 0.7633\n","Epoch 5/50\n","427/427 [==============================] - 431s 1s/step - det_loss: 0.6546 - cls_loss: 0.4223 - box_loss: 0.0046 - reg_l2_loss: 0.0843 - loss: 0.7388 - learning_rate: 0.0392 - gradient_norm: 1.6866 - val_det_loss: 0.8730 - val_cls_loss: 0.5537 - val_box_loss: 0.0064 - val_reg_l2_loss: 0.0856 - val_loss: 0.9586\n","Epoch 6/50\n","427/427 [==============================] - 390s 912ms/step - det_loss: 0.6437 - cls_loss: 0.4159 - box_loss: 0.0046 - reg_l2_loss: 0.0867 - loss: 0.7305 - learning_rate: 0.0388 - gradient_norm: 1.6092 - val_det_loss: 0.7163 - val_cls_loss: 0.4540 - val_box_loss: 0.0052 - val_reg_l2_loss: 0.0877 - val_loss: 0.8040\n","Epoch 7/50\n","427/427 [==============================] - 389s 912ms/step - det_loss: 0.6270 - cls_loss: 0.4057 - box_loss: 0.0044 - reg_l2_loss: 0.0886 - loss: 0.7156 - learning_rate: 0.0383 - gradient_norm: 1.5835 - val_det_loss: 0.6237 - val_cls_loss: 0.4145 - val_box_loss: 0.0042 - val_reg_l2_loss: 0.0895 - val_loss: 0.7132\n","Epoch 8/50\n","427/427 [==============================] - 391s 915ms/step - det_loss: 0.6117 - cls_loss: 0.3937 - box_loss: 0.0044 - reg_l2_loss: 0.0903 - loss: 0.7020 - learning_rate: 0.0377 - gradient_norm: 1.5427 - val_det_loss: 0.5881 - val_cls_loss: 0.3753 - val_box_loss: 0.0043 - val_reg_l2_loss: 0.0911 - val_loss: 0.6792\n","Epoch 9/50\n","427/427 [==============================] - 390s 913ms/step - det_loss: 0.6027 - cls_loss: 0.3887 - box_loss: 0.0043 - reg_l2_loss: 0.0918 - loss: 0.6945 - learning_rate: 0.0371 - gradient_norm: 1.5184 - val_det_loss: 0.7414 - val_cls_loss: 0.4917 - val_box_loss: 0.0050 - val_reg_l2_loss: 0.0925 - val_loss: 0.8338\n","Epoch 10/50\n","427/427 [==============================] - 420s 984ms/step - det_loss: 0.5954 - cls_loss: 0.3832 - box_loss: 0.0042 - reg_l2_loss: 0.0932 - loss: 0.6885 - learning_rate: 0.0364 - gradient_norm: 1.5179 - val_det_loss: 0.5737 - val_cls_loss: 0.3809 - val_box_loss: 0.0039 - val_reg_l2_loss: 0.0938 - val_loss: 0.6675\n","Epoch 11/50\n","427/427 [==============================] - 390s 913ms/step - det_loss: 0.5753 - cls_loss: 0.3700 - box_loss: 0.0041 - reg_l2_loss: 0.0944 - loss: 0.6697 - learning_rate: 0.0356 - gradient_norm: 1.5197 - val_det_loss: 0.6140 - val_cls_loss: 0.3975 - val_box_loss: 0.0043 - val_reg_l2_loss: 0.0950 - val_loss: 0.7090\n","Epoch 12/50\n","427/427 [==============================] - 390s 914ms/step - det_loss: 0.5776 - cls_loss: 0.3707 - box_loss: 0.0041 - reg_l2_loss: 0.0957 - loss: 0.6732 - learning_rate: 0.0348 - gradient_norm: 1.5397 - val_det_loss: 0.5819 - val_cls_loss: 0.3888 - val_box_loss: 0.0039 - val_reg_l2_loss: 0.0963 - val_loss: 0.6781\n","Epoch 13/50\n","427/427 [==============================] - 390s 913ms/step - det_loss: 0.5656 - cls_loss: 0.3650 - box_loss: 0.0040 - reg_l2_loss: 0.0968 - loss: 0.6624 - learning_rate: 0.0339 - gradient_norm: 1.4970 - val_det_loss: 0.5621 - val_cls_loss: 0.3587 - val_box_loss: 0.0041 - val_reg_l2_loss: 0.0973 - val_loss: 0.6594\n","Epoch 14/50\n","427/427 [==============================] - 389s 911ms/step - det_loss: 0.5652 - cls_loss: 0.3610 - box_loss: 0.0041 - reg_l2_loss: 0.0977 - loss: 0.6629 - learning_rate: 0.0330 - gradient_norm: 1.4966 - val_det_loss: 0.5450 - val_cls_loss: 0.3474 - val_box_loss: 0.0040 - val_reg_l2_loss: 0.0982 - val_loss: 0.6432\n","Epoch 15/50\n","427/427 [==============================] - 421s 986ms/step - det_loss: 0.5556 - cls_loss: 0.3549 - box_loss: 0.0040 - reg_l2_loss: 0.0986 - loss: 0.6542 - learning_rate: 0.0320 - gradient_norm: 1.5234 - val_det_loss: 0.5133 - val_cls_loss: 0.3306 - val_box_loss: 0.0037 - val_reg_l2_loss: 0.0991 - val_loss: 0.6124\n","Epoch 16/50\n","427/427 [==============================] - 390s 914ms/step - det_loss: 0.5429 - cls_loss: 0.3480 - box_loss: 0.0039 - reg_l2_loss: 0.0995 - loss: 0.6424 - learning_rate: 0.0309 - gradient_norm: 1.4943 - val_det_loss: 0.5794 - val_cls_loss: 0.3726 - val_box_loss: 0.0041 - val_reg_l2_loss: 0.0998 - val_loss: 0.6792\n","Epoch 17/50\n","427/427 [==============================] - 390s 914ms/step - det_loss: 0.5346 - cls_loss: 0.3428 - box_loss: 0.0038 - reg_l2_loss: 0.1001 - loss: 0.6347 - learning_rate: 0.0298 - gradient_norm: 1.5066 - val_det_loss: 0.4930 - val_cls_loss: 0.3115 - val_box_loss: 0.0036 - val_reg_l2_loss: 0.1005 - val_loss: 0.5934\n","Epoch 18/50\n","427/427 [==============================] - 390s 913ms/step - det_loss: 0.5235 - cls_loss: 0.3361 - box_loss: 0.0037 - reg_l2_loss: 0.1008 - loss: 0.6243 - learning_rate: 0.0287 - gradient_norm: 1.5090 - val_det_loss: 0.5285 - val_cls_loss: 0.3372 - val_box_loss: 0.0038 - val_reg_l2_loss: 0.1011 - val_loss: 0.6296\n","Epoch 19/50\n","427/427 [==============================] - 390s 913ms/step - det_loss: 0.5212 - cls_loss: 0.3342 - box_loss: 0.0037 - reg_l2_loss: 0.1013 - loss: 0.6226 - learning_rate: 0.0275 - gradient_norm: 1.5162 - val_det_loss: 0.5719 - val_cls_loss: 0.3750 - val_box_loss: 0.0039 - val_reg_l2_loss: 0.1016 - val_loss: 0.6734\n","Epoch 20/50\n","427/427 [==============================] - 420s 984ms/step - det_loss: 0.5095 - cls_loss: 0.3258 - box_loss: 0.0037 - reg_l2_loss: 0.1018 - loss: 0.6113 - learning_rate: 0.0263 - gradient_norm: 1.4868 - val_det_loss: 0.4608 - val_cls_loss: 0.2938 - val_box_loss: 0.0033 - val_reg_l2_loss: 0.1019 - val_loss: 0.5628\n","Epoch 21/50\n","427/427 [==============================] - 391s 915ms/step - det_loss: 0.5015 - cls_loss: 0.3220 - box_loss: 0.0036 - reg_l2_loss: 0.1021 - loss: 0.6036 - learning_rate: 0.0251 - gradient_norm: 1.4979 - val_det_loss: 0.4841 - val_cls_loss: 0.3084 - val_box_loss: 0.0035 - val_reg_l2_loss: 0.1023 - val_loss: 0.5863\n","Epoch 22/50\n","427/427 [==============================] - 390s 913ms/step - det_loss: 0.4945 - cls_loss: 0.3163 - box_loss: 0.0036 - reg_l2_loss: 0.1024 - loss: 0.5969 - learning_rate: 0.0238 - gradient_norm: 1.5505 - val_det_loss: 0.4822 - val_cls_loss: 0.3064 - val_box_loss: 0.0035 - val_reg_l2_loss: 0.1026 - val_loss: 0.5847\n","Epoch 23/50\n","427/427 [==============================] - 390s 914ms/step - det_loss: 0.4880 - cls_loss: 0.3130 - box_loss: 0.0035 - reg_l2_loss: 0.1027 - loss: 0.5907 - learning_rate: 0.0226 - gradient_norm: 1.5327 - val_det_loss: 0.4285 - val_cls_loss: 0.2678 - val_box_loss: 0.0032 - val_reg_l2_loss: 0.1028 - val_loss: 0.5313\n","Epoch 24/50\n","427/427 [==============================] - 390s 914ms/step - det_loss: 0.4780 - cls_loss: 0.3064 - box_loss: 0.0034 - reg_l2_loss: 0.1029 - loss: 0.5809 - learning_rate: 0.0213 - gradient_norm: 1.5150 - val_det_loss: 0.4527 - val_cls_loss: 0.2857 - val_box_loss: 0.0033 - val_reg_l2_loss: 0.1030 - val_loss: 0.5557\n","Epoch 25/50\n","427/427 [==============================] - 419s 981ms/step - det_loss: 0.4713 - cls_loss: 0.3012 - box_loss: 0.0034 - reg_l2_loss: 0.1030 - loss: 0.5744 - learning_rate: 0.0200 - gradient_norm: 1.5631 - val_det_loss: 0.4426 - val_cls_loss: 0.2863 - val_box_loss: 0.0031 - val_reg_l2_loss: 0.1031 - val_loss: 0.5457\n","Epoch 26/50\n","427/427 [==============================] - 389s 911ms/step - det_loss: 0.4649 - cls_loss: 0.2967 - box_loss: 0.0034 - reg_l2_loss: 0.1031 - loss: 0.5681 - learning_rate: 0.0187 - gradient_norm: 1.5408 - val_det_loss: 0.4083 - val_cls_loss: 0.2621 - val_box_loss: 0.0029 - val_reg_l2_loss: 0.1032 - val_loss: 0.5114\n","Epoch 27/50\n","427/427 [==============================] - 389s 911ms/step - det_loss: 0.4589 - cls_loss: 0.2932 - box_loss: 0.0033 - reg_l2_loss: 0.1032 - loss: 0.5621 - learning_rate: 0.0174 - gradient_norm: 1.5932 - val_det_loss: 0.5174 - val_cls_loss: 0.3362 - val_box_loss: 0.0036 - val_reg_l2_loss: 0.1032 - val_loss: 0.6206\n","Epoch 28/50\n","427/427 [==============================] - 390s 912ms/step - det_loss: 0.4579 - cls_loss: 0.2919 - box_loss: 0.0033 - reg_l2_loss: 0.1033 - loss: 0.5611 - learning_rate: 0.0162 - gradient_norm: 1.6211 - val_det_loss: 0.4339 - val_cls_loss: 0.2783 - val_box_loss: 0.0031 - val_reg_l2_loss: 0.1033 - val_loss: 0.5371\n","Epoch 29/50\n","427/427 [==============================] - 390s 914ms/step - det_loss: 0.4442 - cls_loss: 0.2825 - box_loss: 0.0032 - reg_l2_loss: 0.1033 - loss: 0.5474 - learning_rate: 0.0149 - gradient_norm: 1.5839 - val_det_loss: 0.5304 - val_cls_loss: 0.3519 - val_box_loss: 0.0036 - val_reg_l2_loss: 0.1032 - val_loss: 0.6337\n","Epoch 30/50\n","427/427 [==============================] - 419s 980ms/step - det_loss: 0.4399 - cls_loss: 0.2799 - box_loss: 0.0032 - reg_l2_loss: 0.1032 - loss: 0.5431 - learning_rate: 0.0137 - gradient_norm: 1.5834 - val_det_loss: 0.4506 - val_cls_loss: 0.2948 - val_box_loss: 0.0031 - val_reg_l2_loss: 0.1032 - val_loss: 0.5538\n","Epoch 31/50\n","427/427 [==============================] - 388s 910ms/step - det_loss: 0.4344 - cls_loss: 0.2755 - box_loss: 0.0032 - reg_l2_loss: 0.1031 - loss: 0.5375 - learning_rate: 0.0125 - gradient_norm: 1.5794 - val_det_loss: 0.4210 - val_cls_loss: 0.2731 - val_box_loss: 0.0030 - val_reg_l2_loss: 0.1031 - val_loss: 0.5241\n","Epoch 32/50\n","427/427 [==============================] - 389s 911ms/step - det_loss: 0.4251 - cls_loss: 0.2695 - box_loss: 0.0031 - reg_l2_loss: 0.1030 - loss: 0.5281 - learning_rate: 0.0113 - gradient_norm: 1.6299 - val_det_loss: 0.5255 - val_cls_loss: 0.3573 - val_box_loss: 0.0034 - val_reg_l2_loss: 0.1030 - val_loss: 0.6285\n","Epoch 33/50\n","427/427 [==============================] - 388s 909ms/step - det_loss: 0.4155 - cls_loss: 0.2637 - box_loss: 0.0030 - reg_l2_loss: 0.1029 - loss: 0.5184 - learning_rate: 0.0102 - gradient_norm: 1.5932 - val_det_loss: 0.5369 - val_cls_loss: 0.3630 - val_box_loss: 0.0035 - val_reg_l2_loss: 0.1029 - val_loss: 0.6398\n","Epoch 34/50\n","427/427 [==============================] - 389s 911ms/step - det_loss: 0.4119 - cls_loss: 0.2615 - box_loss: 0.0030 - reg_l2_loss: 0.1028 - loss: 0.5147 - learning_rate: 0.0091 - gradient_norm: 1.6797 - val_det_loss: 0.4313 - val_cls_loss: 0.2871 - val_box_loss: 0.0029 - val_reg_l2_loss: 0.1028 - val_loss: 0.5340\n","Epoch 35/50\n","427/427 [==============================] - 417s 977ms/step - det_loss: 0.4044 - cls_loss: 0.2560 - box_loss: 0.0030 - reg_l2_loss: 0.1027 - loss: 0.5071 - learning_rate: 0.0080 - gradient_norm: 1.6136 - val_det_loss: 0.4556 - val_cls_loss: 0.2985 - val_box_loss: 0.0031 - val_reg_l2_loss: 0.1026 - val_loss: 0.5582\n","Epoch 36/50\n","427/427 [==============================] - 388s 909ms/step - det_loss: 0.3988 - cls_loss: 0.2531 - box_loss: 0.0029 - reg_l2_loss: 0.1026 - loss: 0.5014 - learning_rate: 0.0070 - gradient_norm: 1.6407 - val_det_loss: 0.4377 - val_cls_loss: 0.2870 - val_box_loss: 0.0030 - val_reg_l2_loss: 0.1025 - val_loss: 0.5402\n","Epoch 37/50\n","427/427 [==============================] - 389s 911ms/step - det_loss: 0.3967 - cls_loss: 0.2512 - box_loss: 0.0029 - reg_l2_loss: 0.1025 - loss: 0.4992 - learning_rate: 0.0061 - gradient_norm: 1.6549 - val_det_loss: 0.4184 - val_cls_loss: 0.2756 - val_box_loss: 0.0029 - val_reg_l2_loss: 0.1024 - val_loss: 0.5208\n","Epoch 38/50\n","427/427 [==============================] - 389s 911ms/step - det_loss: 0.3911 - cls_loss: 0.2478 - box_loss: 0.0029 - reg_l2_loss: 0.1023 - loss: 0.4934 - learning_rate: 0.0052 - gradient_norm: 1.6500 - val_det_loss: 0.4459 - val_cls_loss: 0.2909 - val_box_loss: 0.0031 - val_reg_l2_loss: 0.1023 - val_loss: 0.5482\n","Epoch 39/50\n","427/427 [==============================] - 389s 911ms/step - det_loss: 0.3862 - cls_loss: 0.2439 - box_loss: 0.0028 - reg_l2_loss: 0.1022 - loss: 0.4884 - learning_rate: 0.0044 - gradient_norm: 1.5965 - val_det_loss: 0.4190 - val_cls_loss: 0.2729 - val_box_loss: 0.0029 - val_reg_l2_loss: 0.1022 - val_loss: 0.5211\n","Epoch 40/50\n","427/427 [==============================] - 418s 978ms/step - det_loss: 0.3823 - cls_loss: 0.2420 - box_loss: 0.0028 - reg_l2_loss: 0.1021 - loss: 0.4844 - learning_rate: 0.0036 - gradient_norm: 1.6074 - val_det_loss: 0.4130 - val_cls_loss: 0.2700 - val_box_loss: 0.0029 - val_reg_l2_loss: 0.1021 - val_loss: 0.5151\n","Epoch 41/50\n","427/427 [==============================] - 389s 911ms/step - det_loss: 0.3747 - cls_loss: 0.2374 - box_loss: 0.0027 - reg_l2_loss: 0.1020 - loss: 0.4767 - learning_rate: 0.0029 - gradient_norm: 1.6342 - val_det_loss: 0.3992 - val_cls_loss: 0.2602 - val_box_loss: 0.0028 - val_reg_l2_loss: 0.1020 - val_loss: 0.5012\n","Epoch 42/50\n","427/427 [==============================] - 391s 916ms/step - det_loss: 0.3738 - cls_loss: 0.2368 - box_loss: 0.0027 - reg_l2_loss: 0.1020 - loss: 0.4757 - learning_rate: 0.0023 - gradient_norm: 1.6568 - val_det_loss: 0.4039 - val_cls_loss: 0.2616 - val_box_loss: 0.0028 - val_reg_l2_loss: 0.1019 - val_loss: 0.5058\n","Epoch 43/50\n","427/427 [==============================] - 394s 922ms/step - det_loss: 0.3704 - cls_loss: 0.2343 - box_loss: 0.0027 - reg_l2_loss: 0.1019 - loss: 0.4724 - learning_rate: 0.0017 - gradient_norm: 1.6299 - val_det_loss: 0.4057 - val_cls_loss: 0.2633 - val_box_loss: 0.0028 - val_reg_l2_loss: 0.1019 - val_loss: 0.5076\n","Epoch 44/50\n","427/427 [==============================] - 393s 921ms/step - det_loss: 0.3673 - cls_loss: 0.2320 - box_loss: 0.0027 - reg_l2_loss: 0.1019 - loss: 0.4692 - learning_rate: 0.0012 - gradient_norm: 1.5899 - val_det_loss: 0.4113 - val_cls_loss: 0.2679 - val_box_loss: 0.0029 - val_reg_l2_loss: 0.1019 - val_loss: 0.5132\n","Epoch 45/50\n","427/427 [==============================] - 424s 993ms/step - det_loss: 0.3682 - cls_loss: 0.2326 - box_loss: 0.0027 - reg_l2_loss: 0.1018 - loss: 0.4701 - learning_rate: 8.2994e-04 - gradient_norm: 1.6149 - val_det_loss: 0.4135 - val_cls_loss: 0.2708 - val_box_loss: 0.0029 - val_reg_l2_loss: 0.1018 - val_loss: 0.5154\n","Epoch 46/50\n","427/427 [==============================] - 394s 922ms/step - det_loss: 0.3670 - cls_loss: 0.2314 - box_loss: 0.0027 - reg_l2_loss: 0.1018 - loss: 0.4688 - learning_rate: 5.0480e-04 - gradient_norm: 1.6528 - val_det_loss: 0.4119 - val_cls_loss: 0.2706 - val_box_loss: 0.0028 - val_reg_l2_loss: 0.1018 - val_loss: 0.5137\n","Epoch 47/50\n","427/427 [==============================] - 392s 917ms/step - det_loss: 0.3658 - cls_loss: 0.2307 - box_loss: 0.0027 - reg_l2_loss: 0.1018 - loss: 0.4676 - learning_rate: 2.5976e-04 - gradient_norm: 1.6013 - val_det_loss: 0.4104 - val_cls_loss: 0.2686 - val_box_loss: 0.0028 - val_reg_l2_loss: 0.1018 - val_loss: 0.5122\n","Epoch 48/50\n","427/427 [==============================] - 391s 916ms/step - det_loss: 0.3642 - cls_loss: 0.2304 - box_loss: 0.0027 - reg_l2_loss: 0.1018 - loss: 0.4660 - learning_rate: 9.5843e-05 - gradient_norm: 1.6140 - val_det_loss: 0.4104 - val_cls_loss: 0.2686 - val_box_loss: 0.0028 - val_reg_l2_loss: 0.1018 - val_loss: 0.5122\n","Epoch 49/50\n","427/427 [==============================] - 393s 921ms/step - det_loss: 0.3638 - cls_loss: 0.2299 - box_loss: 0.0027 - reg_l2_loss: 0.1018 - loss: 0.4656 - learning_rate: 1.3715e-05 - gradient_norm: 1.6306 - val_det_loss: 0.4118 - val_cls_loss: 0.2692 - val_box_loss: 0.0029 - val_reg_l2_loss: 0.1018 - val_loss: 0.5136\n","Epoch 50/50\n","427/427 [==============================] - 424s 993ms/step - det_loss: 0.3635 - cls_loss: 0.2298 - box_loss: 0.0027 - reg_l2_loss: 0.1018 - loss: 0.4653 - learning_rate: 1.3715e-05 - gradient_norm: 1.6447 - val_det_loss: 0.4117 - val_cls_loss: 0.2696 - val_box_loss: 0.0028 - val_reg_l2_loss: 0.1018 - val_loss: 0.5135\n","Evaluating model...\n","48/48 [==============================] - 39s 548ms/step\n","\n","AP              : 0.5564856\n","AP50            : 0.7340991\n","AP75            : 0.621961\n","APs             : 0.009013607\n","APm             : 0.25775763\n","APl             : 0.5889209\n","ARmax1          : 0.5167887\n","ARmax10         : 0.6841311\n","ARmax100        : 0.708694\n","ARs             : 0.118896395\n","ARm             : 0.52452046\n","ARl             : 0.74965507\n","AP_/Person      : 0.14626184\n","AP_/Dog         : 0.77488035\n","AP_/Cat         : 0.759069\n","AP_/Human_head  : 0.22012962\n","AP_/Deer        : 0.6800022\n","AP_/Squirrel    : 0.71803194\n","AP_/Bird        : 0.59702414\n","Evaluating tflite default...\n","1530/1530 [==============================] - 8316s 5s/step\n","\n","AP              : 0.5412398\n","AP50            : 0.7222578\n","AP75            : 0.6092865\n","APs             : 0.0028590902\n","APm             : 0.21585949\n","APl             : 0.5714136\n","ARmax1          : 0.5080233\n","ARmax10         : 0.63549304\n","ARmax100        : 0.63549304\n","ARs             : 0.027083334\n","ARm             : 0.43173745\n","ARl             : 0.6796587\n","AP_/Person      : 0.1337361\n","AP_/Dog         : 0.7562943\n","AP_/Cat         : 0.7362521\n","AP_/Human_head  : 0.20076427\n","AP_/Deer        : 0.66592854\n","AP_/Squirrel    : 0.7110523\n","AP_/Bird        : 0.58465093\n","Evaluating tflite float16...\n","1530/1530 [==============================] - 232s 152ms/step\n","\n","AP              : 0.5451764\n","AP50            : 0.7227202\n","AP75            : 0.6077595\n","APs             : 0.0020090158\n","APm             : 0.2327806\n","APl             : 0.5754825\n","ARmax1          : 0.5111125\n","ARmax10         : 0.6392959\n","ARmax100        : 0.6392959\n","ARs             : 0.027083334\n","ARm             : 0.3889273\n","ARl             : 0.68370324\n","AP_/Person      : 0.13541836\n","AP_/Dog         : 0.7637142\n","AP_/Cat         : 0.7436603\n","AP_/Human_head  : 0.19902661\n","AP_/Deer        : 0.6691725\n","AP_/Squirrel    : 0.71237695\n","AP_/Bird        : 0.5928659\n","Com.piling for \"model_default.tflite\" for Edge TPU...\n","File size of 5832 bytes will give 1 TPUs...\n","\n","edge_tpu_1\n","\n","Edge TPU Compiler version 16.0.384591198\n","Searching for valid delegate with step 1\n","Try to compile segment with 322 ops\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 321 ops\n","Intermediate tensors: Sigmoid1,tfl.dequantize\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 320 ops\n","Intermediate tensors: concat_1,Sigmoid1\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 319 ops\n","Intermediate tensors: Reshape_1,Reshape_7,Sigmoid1,Reshape_9,Reshape_3,Reshape_5\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 318 ops\n","Intermediate tensors: Reshape_1,Reshape_7,Sigmoid1,box_net/box-predict/BiasAdd_4;box_net/box-predict/separable_conv2d_4;box_net/box-predict/bias11,Reshape_3,Reshape_5\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 317 ops\n","Intermediate tensors: Reshape_5,Reshape_7,Sigmoid1,box_net/box-predict/separable_conv2d_4/depthwise1,Reshape_1,Reshape_3\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 316 ops\n","Intermediate tensors: Reshape_5,Reshape_7,Sigmoid1,Relu6_14;Relu6_14;box-2-bn-7/FusedBatchNormV3;box-2-bn-7/FusedBatchNormV3;box_net/box-2/bias;box-2/BiasAdd_4;box-2/BiasAdd_4;class_net/class-predict/separable_conv2d_4/depthwise;box-2/separable_conv2d_4;box-2/separable_conv2d_41,Reshape_1,Reshape_3\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 315 ops\n","Intermediate tensors: Reshape_1,Reshape_7,Sigmoid1,box-2/separable_conv2d_4/depthwise;box-2/separable_conv2d_4/depthwise1,Reshape_3,Reshape_5\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 314 ops\n","Intermediate tensors: Reshape_5,Sigmoid1,Relu6_13;Relu6_13;box-1-bn-7/FusedBatchNormV3;box-1-bn-7/FusedBatchNormV3;box_net/box-1/bias;box-1/BiasAdd_4;box-1/BiasAdd_4;class_net/class-predict/separable_conv2d_4/depthwise;box-1/separable_conv2d_4;box-1/separable_conv2d_41,Reshape_3,Reshape_1,Reshape_7\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 313 ops\n","Intermediate tensors: Reshape_5,Reshape_7,Sigmoid1,box-1/separable_conv2d_4/depthwise;box-1/separable_conv2d_4/depthwise1,Reshape_1,Reshape_3\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 312 ops\n","Intermediate tensors: Reshape_1,Reshape_7,Sigmoid1,Relu6_12;Relu6_12;box-0-bn-7/FusedBatchNormV3;box-0-bn-7/FusedBatchNormV3;box_net/box-0/bias;box-0/BiasAdd_4;box-0/BiasAdd_4;class_net/class-predict/separable_conv2d_4/depthwise;box-0/separable_conv2d_4;box-0/separable_conv2d_41,Reshape_3,Reshape_5\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 311 ops\n","Intermediate tensors: Reshape_5,Reshape_7,Sigmoid1,box-0/separable_conv2d_4/depthwise;box-0/separable_conv2d_4/depthwise1,Reshape_1,Reshape_3\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 310 ops\n","Intermediate tensors: Reshape_1,Reshape_7,Sigmoid1,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d,Reshape_3,Reshape_5\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 309 ops\n","Intermediate tensors: Reshape_5,Reshape_7,Sigmoid,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d,Reshape_1,Reshape_3\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 308 ops\n","Intermediate tensors: Reshape_5,Reshape_7,concat,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d,Reshape_1,Reshape_3\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 307 ops\n","Intermediate tensors: Reshape_3,Reshape_6,Reshape_2,Reshape_5,Reshape_1,Reshape_4,Reshape_8,Reshape,Reshape_7,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 306 ops\n","Intermediate tensors: Reshape_4,Reshape,Reshape_7,Reshape_3,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d,Reshape_6,class_net/class-predict/BiasAdd_4;class_net/class-predict/separable_conv2d_4;class_net/class-predict/bias11,Reshape_2,Reshape_5,Reshape_1\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 305 ops\n","Intermediate tensors: Reshape_1,Reshape_5,Reshape_2,Reshape_6,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d,Reshape_3,Reshape_7,Reshape,class_net/class-predict/separable_conv2d_4/depthwise210,Reshape_4\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 304 ops\n","Intermediate tensors: Reshape_3,Reshape_6,Reshape_2,Reshape_5,Relu6_14;Relu6_14;class-2-bn-7/FusedBatchNormV3;class-2-bn-7/FusedBatchNormV3;class_net/class-2/bias;class-2/BiasAdd_4;class-2/BiasAdd_4;class_net/class-predict/separable_conv2d_4/depthwise;class-2/separable_conv2d_4;class-2/separable_conv2d_41,Reshape_1,Reshape_4,Reshape,Reshape_7,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 303 ops\n","Intermediate tensors: Reshape_1,Reshape_5,class-2/separable_conv2d_4/depthwise;class-2/separable_conv2d_4/depthwise1,Reshape_2,Reshape_6,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d,Reshape_3,Reshape_7,Reshape,Reshape_4\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 302 ops\n","Intermediate tensors: Reshape_6,Reshape_3,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d,Reshape_7,Reshape,Reshape_4,Relu6_13;Relu6_13;class-1-bn-7/FusedBatchNormV3;class-1-bn-7/FusedBatchNormV3;class_net/class-1/bias;class-1/BiasAdd_4;class-1/BiasAdd_4;class_net/class-predict/separable_conv2d_4/depthwise;class-1/separable_conv2d_4;class-1/separable_conv2d_41,Reshape_1,Reshape_5,Reshape_2\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 301 ops\n","Intermediate tensors: Reshape_1,Reshape_5,Reshape_2,Reshape_6,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d,Reshape_3,Reshape_7,Reshape,class-1/separable_conv2d_4/depthwise;class-1/separable_conv2d_4/depthwise1,Reshape_4\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 300 ops\n","Intermediate tensors: Reshape_6,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d,Reshape_2,Relu6_12;Relu6_12;class-0-bn-7/FusedBatchNormV3;class-0-bn-7/FusedBatchNormV3;class_net/class-0/bias;class-0/BiasAdd_4;class-0/BiasAdd_4;class_net/class-predict/separable_conv2d_4/depthwise;class-0/separable_conv2d_4;class-0/separable_conv2d_41,Reshape_5,Reshape_1,Reshape_4,Reshape,Reshape_7,Reshape_3\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 299 ops\n","Intermediate tensors: Reshape_1,Reshape_5,class-0/separable_conv2d_4/depthwise;class-0/separable_conv2d_4/depthwise1,Reshape_2,Reshape_6,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d,Reshape_3,Reshape_7,Reshape,Reshape_4\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 298 ops\n","Intermediate tensors: Reshape_3,Reshape_6,Reshape_2,Reshape_5,Reshape_1,Reshape_4,Reshape,Reshape_7,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 297 ops\n","Intermediate tensors: Reshape_4,Reshape,Reshape_7,Reshape_3,Reshape_6,Reshape_2,cell_3/fnode7/op_after_combine12/conv/separable_conv2d/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d/depthwise1,Reshape_5,Reshape_1\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 296 ops\n","Intermediate tensors: Reshape_3,Reshape_6,cell_3/fnode7/op_after_combine12/Relu6;cell_3/fnode7/op_after_combine12/Relu6;cell_3/fnode7/add_n/add;cell_3/fnode7/add_n/add,Reshape_2,Reshape_5,Reshape_1,Reshape_4,Reshape,Reshape_7\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 295 ops\n","Intermediate tensors: Reshape_6,Reshape_2,cell_3/fnode7/resample_1_11_12/max_pooling2d_15/MaxPool;cell_3/fnode7/resample_1_11_12/max_pooling2d_15/MaxPool,Reshape_5,Reshape_1,cell_2/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_2/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_2/fnode7/op_after_combine12/conv/bias;cell_2/fnode7/op_after_combine12/conv/BiasAdd;cell_2/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_2/fnode7/op_after_combine12/conv/separable_conv2d;cell_2/fnode7/op_after_combine12/conv/separable_conv2d,Reshape_4,Reshape,Reshape_7,Reshape_3\n","Started a compilation timeout timer of 180 seconds.\n","\n","Model compiled successfully in 2658 ms.\n","\n","Input model: model_default.tflite\n","Input size: 5.69MiB\n","Output model: edge_tpu_1/model_default_edgetpu.tflite\n","Output size: 6.55MiB\n","On-chip memory used for caching model parameters: 5.21MiB\n","On-chip memory remaining for caching model parameters: 2.29MiB\n","Off-chip memory used for streaming uncached model parameters: 0.00B\n","Number of Edge TPU subgraphs: 1\n","Total number of operations: 322\n","Operation log: edge_tpu_1/model_default_edgetpu.log\n","\n","Model successfully compiled but not all operations are supported by the Edge TPU. A percentage of the model will instead run on the CPU, which is slower. If possible, consider updating your model to use only operations supported by the Edge TPU. For details, visit g.co/coral/model-reqs.\n","Number of operations that will run on Edge TPU: 191\n","Number of operations that will run on CPU: 131\n","See the operation log file for individual operation details.\n","Compilation child process completed within timeout period.\n","Compilation succeeded! \n","\n","edge_tpu_2\n","\n","Edge TPU Compiler version 16.0.384591198\n","Started a compilation timeout timer of 180 seconds.\n","\n","Model compiled successfully in 3936 ms.\n","\n","Input model: model_default.tflite\n","Input size: 5.69MiB\n","Output model: edge_tpu_2/model_default_edgetpu.tflite\n","Output size: 7.35MiB\n","On-chip memory used for caching model parameters: 5.95MiB\n","On-chip memory remaining for caching model parameters: 1.56MiB\n","Off-chip memory used for streaming uncached model parameters: 0.00B\n","Number of Edge TPU subgraphs: 1\n","Total number of operations: 322\n","Operation log: edge_tpu_2/model_default_edgetpu.log\n","\n","Model successfully compiled but not all operations are supported by the Edge TPU. A percentage of the model will instead run on the CPU, which is slower. If possible, consider updating your model to use only operations supported by the Edge TPU. For details, visit g.co/coral/model-reqs.\n","Number of operations that will run on Edge TPU: 316\n","Number of operations that will run on CPU: 6\n","\n","Operator                       Count      Status\n","\n","RESHAPE                        1          More than one subgraph is not supported\n","RESHAPE                        9          Mapped to Edge TPU\n","CONCATENATION                  1          More than one subgraph is not supported\n","CONCATENATION                  1          Mapped to Edge TPU\n","CUSTOM                         1          Operation is working on an unsupported data type\n","ADD                            58         Mapped to Edge TPU\n","MAX_POOL_2D                    18         Mapped to Edge TPU\n","DEQUANTIZE                     2          Operation is working on an unsupported data type\n","QUANTIZE                       1          Mapped to Edge TPU\n","CONV_2D                        120        Mapped to Edge TPU\n","DEPTHWISE_CONV_2D              93         Mapped to Edge TPU\n","LOGISTIC                       1          Operation is otherwise supported, but not mapped due to some unspecified limitation\n","RESIZE_NEAREST_NEIGHBOR        16         Mapped to Edge TPU\n","Compilation child process completed within timeout period.\n","Compilation succeeded! \n","\n","Com.piling for \"model_int8.tflite\" for Edge TPU...\n","File size of 5832 bytes will give 1 TPUs...\n","\n","edge_tpu_1\n","\n","Edge TPU Compiler version 16.0.384591198\n","Searching for valid delegate with step 1\n","Try to compile segment with 330 ops\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 329 ops\n","Intermediate tensors: StatefulPartitionedCall:0,tfl.quantize3,StatefulPartitionedCall:3,StatefulPartitionedCall:2\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 328 ops\n","Intermediate tensors: tfl.quantize1,tfl.quantize4,StatefulPartitionedCall:2,StatefulPartitionedCall:1\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 327 ops\n","Intermediate tensors: tfl.quantize1,tfl.quantize4,tfl.quantize3,StatefulPartitionedCall:2\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 326 ops\n","Intermediate tensors: tfl.quantize1,tfl.quantize3,tfl.quantize4,tfl.quantize2\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 325 ops\n","\n","edge_tpu_2\n","\n","Edge TPU Compiler version 16.0.384591198\n","Started a compilation timeout timer of 180 seconds.\n","\n","Model compiled successfully in 3937 ms.\n","\n","Input model: model_int8.tflite\n","Input size: 5.69MiB\n","Output model: edge_tpu_2/model_int8_edgetpu.tflite\n","Output size: 7.36MiB\n","On-chip memory used for caching model parameters: 5.95MiB\n","On-chip memory remaining for caching model parameters: 1.56MiB\n","Off-chip memory used for streaming uncached model parameters: 0.00B\n","Number of Edge TPU subgraphs: 1\n","Total number of operations: 330\n","Operation log: edge_tpu_2/model_int8_edgetpu.log\n","\n","Model successfully compiled but not all operations are supported by the Edge TPU. A percentage of the model will instead run on the CPU, which is slower. If possible, consider updating your model to use only operations supported by the Edge TPU. For details, visit g.co/coral/model-reqs.\n","Number of operations that will run on Edge TPU: 316\n","Number of operations that will run on CPU: 14\n","\n","Operator                       Count      Status\n","\n","CONCATENATION                  1          Mapped to Edge TPU\n","CONCATENATION                  1          More than one subgraph is not supported\n","LOGISTIC                       1          Operation is otherwise supported, but not mapped due to some unspecified limitation\n","RESIZE_NEAREST_NEIGHBOR        16         Mapped to Edge TPU\n","DEPTHWISE_CONV_2D              93         Mapped to Edge TPU\n","CONV_2D                        120        Mapped to Edge TPU\n","DEQUANTIZE                     2          Operation is working on an unsupported data type\n","QUANTIZE                       8          Operation is otherwise supported, but not mapped due to some unspecified limitation\n","QUANTIZE                       1          Mapped to Edge TPU\n","MAX_POOL_2D                    18         Mapped to Edge TPU\n","ADD                            58         Mapped to Edge TPU\n","CUSTOM                         1          Operation is working on an unsupported data type\n","RESHAPE                        1          More than one subgraph is not supported\n","RESHAPE                        9          Mapped to Edge TPU\n","Compilation child process completed within timeout period.\n","Compilation succeeded! \n","\n","Downloading to G-drive...\n","18_08_2022_efficientdet-lite1_e50_b32_s2000\n","model: efficientdet-lite1\n","batch_size: 32\n","Running model...\n","Epoch 1/75\n","427/427 [==============================] - 439s 923ms/step - det_loss: 0.9442 - cls_loss: 0.6201 - box_loss: 0.0065 - reg_l2_loss: 0.0722 - loss: 1.0164 - learning_rate: 0.0240 - gradient_norm: 2.1908 - val_det_loss: 0.8862 - val_cls_loss: 0.5853 - val_box_loss: 0.0060 - val_reg_l2_loss: 0.0738 - val_loss: 0.9600\n","Epoch 2/75\n","427/427 [==============================] - 391s 915ms/step - det_loss: 0.7554 - cls_loss: 0.4904 - box_loss: 0.0053 - reg_l2_loss: 0.0760 - loss: 0.8314 - learning_rate: 0.0400 - gradient_norm: 1.9734 - val_det_loss: 0.8045 - val_cls_loss: 0.5333 - val_box_loss: 0.0054 - val_reg_l2_loss: 0.0778 - val_loss: 0.8822\n","Epoch 3/75\n","427/427 [==============================] - 391s 915ms/step - det_loss: 0.7091 - cls_loss: 0.4596 - box_loss: 0.0050 - reg_l2_loss: 0.0795 - loss: 0.7885 - learning_rate: 0.0399 - gradient_norm: 1.8292 - val_det_loss: 0.7652 - val_cls_loss: 0.5187 - val_box_loss: 0.0049 - val_reg_l2_loss: 0.0809 - val_loss: 0.8462\n","Epoch 4/75\n","427/427 [==============================] - 391s 917ms/step - det_loss: 0.6863 - cls_loss: 0.4434 - box_loss: 0.0049 - reg_l2_loss: 0.0823 - loss: 0.7686 - learning_rate: 0.0398 - gradient_norm: 1.7088 - val_det_loss: 0.7361 - val_cls_loss: 0.4993 - val_box_loss: 0.0047 - val_reg_l2_loss: 0.0835 - val_loss: 0.8196\n","Epoch 5/75\n","427/427 [==============================] - 432s 1s/step - det_loss: 0.6621 - cls_loss: 0.4284 - box_loss: 0.0047 - reg_l2_loss: 0.0847 - loss: 0.7468 - learning_rate: 0.0396 - gradient_norm: 1.6328 - val_det_loss: 0.6585 - val_cls_loss: 0.4431 - val_box_loss: 0.0043 - val_reg_l2_loss: 0.0857 - val_loss: 0.7442\n","Epoch 6/75\n","427/427 [==============================] - 392s 919ms/step - det_loss: 0.6445 - cls_loss: 0.4156 - box_loss: 0.0046 - reg_l2_loss: 0.0868 - loss: 0.7313 - learning_rate: 0.0395 - gradient_norm: 1.5912 - val_det_loss: 0.6648 - val_cls_loss: 0.4326 - val_box_loss: 0.0046 - val_reg_l2_loss: 0.0877 - val_loss: 0.7525\n","Epoch 7/75\n","427/427 [==============================] - 391s 916ms/step - det_loss: 0.6287 - cls_loss: 0.4062 - box_loss: 0.0044 - reg_l2_loss: 0.0887 - loss: 0.7174 - learning_rate: 0.0392 - gradient_norm: 1.5786 - val_det_loss: 0.6559 - val_cls_loss: 0.4219 - val_box_loss: 0.0047 - val_reg_l2_loss: 0.0896 - val_loss: 0.7455\n","Epoch 8/75\n","427/427 [==============================] - 392s 917ms/step - det_loss: 0.6129 - cls_loss: 0.3968 - box_loss: 0.0043 - reg_l2_loss: 0.0904 - loss: 0.7033 - learning_rate: 0.0390 - gradient_norm: 1.5247 - val_det_loss: 0.6131 - val_cls_loss: 0.4000 - val_box_loss: 0.0043 - val_reg_l2_loss: 0.0912 - val_loss: 0.7043\n","Epoch 9/75\n","427/427 [==============================] - 393s 919ms/step - det_loss: 0.6020 - cls_loss: 0.3873 - box_loss: 0.0043 - reg_l2_loss: 0.0920 - loss: 0.6940 - learning_rate: 0.0387 - gradient_norm: 1.5209 - val_det_loss: 0.6185 - val_cls_loss: 0.4087 - val_box_loss: 0.0042 - val_reg_l2_loss: 0.0928 - val_loss: 0.7113\n","Epoch 10/75\n","427/427 [==============================] - 423s 990ms/step - det_loss: 0.5979 - cls_loss: 0.3855 - box_loss: 0.0042 - reg_l2_loss: 0.0936 - loss: 0.6915 - learning_rate: 0.0384 - gradient_norm: 1.5287 - val_det_loss: 0.5590 - val_cls_loss: 0.3712 - val_box_loss: 0.0038 - val_reg_l2_loss: 0.0944 - val_loss: 0.6534\n","Epoch 11/75\n","427/427 [==============================] - 391s 916ms/step - det_loss: 0.5892 - cls_loss: 0.3796 - box_loss: 0.0042 - reg_l2_loss: 0.0951 - loss: 0.6843 - learning_rate: 0.0380 - gradient_norm: 1.5020 - val_det_loss: 0.5929 - val_cls_loss: 0.3863 - val_box_loss: 0.0041 - val_reg_l2_loss: 0.0958 - val_loss: 0.6887\n","Epoch 12/75\n","427/427 [==============================] - 392s 918ms/step - det_loss: 0.5840 - cls_loss: 0.3758 - box_loss: 0.0042 - reg_l2_loss: 0.0964 - loss: 0.6804 - learning_rate: 0.0377 - gradient_norm: 1.4784 - val_det_loss: 0.6628 - val_cls_loss: 0.4453 - val_box_loss: 0.0044 - val_reg_l2_loss: 0.0971 - val_loss: 0.7599\n","Epoch 13/75\n","427/427 [==============================] - 391s 916ms/step - det_loss: 0.5708 - cls_loss: 0.3649 - box_loss: 0.0041 - reg_l2_loss: 0.0977 - loss: 0.6684 - learning_rate: 0.0372 - gradient_norm: 1.4728 - val_det_loss: 0.5694 - val_cls_loss: 0.3722 - val_box_loss: 0.0039 - val_reg_l2_loss: 0.0982 - val_loss: 0.6677\n","Epoch 14/75\n","427/427 [==============================] - 392s 919ms/step - det_loss: 0.5640 - cls_loss: 0.3632 - box_loss: 0.0040 - reg_l2_loss: 0.0988 - loss: 0.6628 - learning_rate: 0.0368 - gradient_norm: 1.4704 - val_det_loss: 0.5274 - val_cls_loss: 0.3441 - val_box_loss: 0.0037 - val_reg_l2_loss: 0.0994 - val_loss: 0.6268\n","Epoch 15/75\n","427/427 [==============================] - 423s 990ms/step - det_loss: 0.5612 - cls_loss: 0.3608 - box_loss: 0.0040 - reg_l2_loss: 0.0999 - loss: 0.6611 - learning_rate: 0.0363 - gradient_norm: 1.4826 - val_det_loss: 0.5906 - val_cls_loss: 0.3717 - val_box_loss: 0.0044 - val_reg_l2_loss: 0.1005 - val_loss: 0.6911\n","Epoch 16/75\n","427/427 [==============================] - 391s 915ms/step - det_loss: 0.5594 - cls_loss: 0.3593 - box_loss: 0.0040 - reg_l2_loss: 0.1011 - loss: 0.6605 - learning_rate: 0.0358 - gradient_norm: 1.4976 - val_det_loss: 0.5262 - val_cls_loss: 0.3361 - val_box_loss: 0.0038 - val_reg_l2_loss: 0.1017 - val_loss: 0.6279\n","Epoch 17/75\n","427/427 [==============================] - 392s 918ms/step - det_loss: 0.5489 - cls_loss: 0.3531 - box_loss: 0.0039 - reg_l2_loss: 0.1021 - loss: 0.6510 - learning_rate: 0.0353 - gradient_norm: 1.4519 - val_det_loss: 0.5820 - val_cls_loss: 0.3740 - val_box_loss: 0.0042 - val_reg_l2_loss: 0.1026 - val_loss: 0.6847\n","Epoch 18/75\n","427/427 [==============================] - 392s 918ms/step - det_loss: 0.5410 - cls_loss: 0.3479 - box_loss: 0.0039 - reg_l2_loss: 0.1031 - loss: 0.6440 - learning_rate: 0.0347 - gradient_norm: 1.4363 - val_det_loss: 0.5314 - val_cls_loss: 0.3325 - val_box_loss: 0.0040 - val_reg_l2_loss: 0.1035 - val_loss: 0.6348\n","Epoch 19/75\n","427/427 [==============================] - 392s 918ms/step - det_loss: 0.5403 - cls_loss: 0.3484 - box_loss: 0.0038 - reg_l2_loss: 0.1039 - loss: 0.6442 - learning_rate: 0.0341 - gradient_norm: 1.4748 - val_det_loss: 0.5307 - val_cls_loss: 0.3544 - val_box_loss: 0.0035 - val_reg_l2_loss: 0.1044 - val_loss: 0.6351\n","Epoch 20/75\n","427/427 [==============================] - 424s 994ms/step - det_loss: 0.5298 - cls_loss: 0.3413 - box_loss: 0.0038 - reg_l2_loss: 0.1048 - loss: 0.6346 - learning_rate: 0.0335 - gradient_norm: 1.4675 - val_det_loss: 0.5395 - val_cls_loss: 0.3451 - val_box_loss: 0.0039 - val_reg_l2_loss: 0.1052 - val_loss: 0.6447\n","Epoch 21/75\n","427/427 [==============================] - 392s 918ms/step - det_loss: 0.5267 - cls_loss: 0.3373 - box_loss: 0.0038 - reg_l2_loss: 0.1056 - loss: 0.6324 - learning_rate: 0.0329 - gradient_norm: 1.4979 - val_det_loss: 0.5420 - val_cls_loss: 0.3496 - val_box_loss: 0.0038 - val_reg_l2_loss: 0.1060 - val_loss: 0.6480\n","Epoch 22/75\n","427/427 [==============================] - 392s 919ms/step - det_loss: 0.5302 - cls_loss: 0.3394 - box_loss: 0.0038 - reg_l2_loss: 0.1066 - loss: 0.6367 - learning_rate: 0.0322 - gradient_norm: 1.4917 - val_det_loss: 0.4992 - val_cls_loss: 0.3262 - val_box_loss: 0.0035 - val_reg_l2_loss: 0.1069 - val_loss: 0.6061\n","Epoch 23/75\n","427/427 [==============================] - 393s 922ms/step - det_loss: 0.5219 - cls_loss: 0.3338 - box_loss: 0.0038 - reg_l2_loss: 0.1072 - loss: 0.6291 - learning_rate: 0.0315 - gradient_norm: 1.4612 - val_det_loss: 0.4777 - val_cls_loss: 0.3092 - val_box_loss: 0.0034 - val_reg_l2_loss: 0.1075 - val_loss: 0.5853\n","Epoch 24/75\n","427/427 [==============================] - 395s 924ms/step - det_loss: 0.5129 - cls_loss: 0.3289 - box_loss: 0.0037 - reg_l2_loss: 0.1078 - loss: 0.6207 - learning_rate: 0.0308 - gradient_norm: 1.4565 - val_det_loss: 0.6163 - val_cls_loss: 0.4169 - val_box_loss: 0.0040 - val_reg_l2_loss: 0.1081 - val_loss: 0.7244\n","Epoch 25/75\n","427/427 [==============================] - 426s 998ms/step - det_loss: 0.5073 - cls_loss: 0.3246 - box_loss: 0.0037 - reg_l2_loss: 0.1084 - loss: 0.6157 - learning_rate: 0.0301 - gradient_norm: 1.4983 - val_det_loss: 0.5134 - val_cls_loss: 0.3301 - val_box_loss: 0.0037 - val_reg_l2_loss: 0.1087 - val_loss: 0.6221\n","Epoch 26/75\n","427/427 [==============================] - 393s 920ms/step - det_loss: 0.5072 - cls_loss: 0.3254 - box_loss: 0.0036 - reg_l2_loss: 0.1090 - loss: 0.6162 - learning_rate: 0.0294 - gradient_norm: 1.4843 - val_det_loss: 0.5565 - val_cls_loss: 0.3645 - val_box_loss: 0.0038 - val_reg_l2_loss: 0.1092 - val_loss: 0.6658\n","Epoch 27/75\n","427/427 [==============================] - 393s 920ms/step - det_loss: 0.4935 - cls_loss: 0.3158 - box_loss: 0.0036 - reg_l2_loss: 0.1094 - loss: 0.6029 - learning_rate: 0.0286 - gradient_norm: 1.4855 - val_det_loss: 0.5877 - val_cls_loss: 0.4044 - val_box_loss: 0.0037 - val_reg_l2_loss: 0.1097 - val_loss: 0.6974\n","Epoch 28/75\n","427/427 [==============================] - 393s 920ms/step - det_loss: 0.4898 - cls_loss: 0.3133 - box_loss: 0.0035 - reg_l2_loss: 0.1099 - loss: 0.5997 - learning_rate: 0.0278 - gradient_norm: 1.4802 - val_det_loss: 0.5024 - val_cls_loss: 0.3356 - val_box_loss: 0.0033 - val_reg_l2_loss: 0.1101 - val_loss: 0.6125\n","Epoch 29/75\n","427/427 [==============================] - 393s 921ms/step - det_loss: 0.4870 - cls_loss: 0.3099 - box_loss: 0.0035 - reg_l2_loss: 0.1103 - loss: 0.5973 - learning_rate: 0.0271 - gradient_norm: 1.5279 - val_det_loss: 0.4743 - val_cls_loss: 0.3146 - val_box_loss: 0.0032 - val_reg_l2_loss: 0.1105 - val_loss: 0.5848\n","Epoch 30/75\n","427/427 [==============================] - 424s 993ms/step - det_loss: 0.4767 - cls_loss: 0.3051 - box_loss: 0.0034 - reg_l2_loss: 0.1107 - loss: 0.5873 - learning_rate: 0.0263 - gradient_norm: 1.4832 - val_det_loss: 0.5129 - val_cls_loss: 0.3390 - val_box_loss: 0.0035 - val_reg_l2_loss: 0.1108 - val_loss: 0.6237\n","Epoch 31/75\n","427/427 [==============================] - 394s 922ms/step - det_loss: 0.4748 - cls_loss: 0.3027 - box_loss: 0.0034 - reg_l2_loss: 0.1110 - loss: 0.5858 - learning_rate: 0.0254 - gradient_norm: 1.4966 - val_det_loss: 0.4973 - val_cls_loss: 0.3251 - val_box_loss: 0.0034 - val_reg_l2_loss: 0.1111 - val_loss: 0.6084\n","Epoch 32/75\n","427/427 [==============================] - 394s 923ms/step - det_loss: 0.4727 - cls_loss: 0.3011 - box_loss: 0.0034 - reg_l2_loss: 0.1112 - loss: 0.5839 - learning_rate: 0.0246 - gradient_norm: 1.5124 - val_det_loss: 0.4742 - val_cls_loss: 0.3055 - val_box_loss: 0.0034 - val_reg_l2_loss: 0.1113 - val_loss: 0.5855\n","Epoch 33/75\n","427/427 [==============================] - 393s 919ms/step - det_loss: 0.4630 - cls_loss: 0.2963 - box_loss: 0.0033 - reg_l2_loss: 0.1114 - loss: 0.5745 - learning_rate: 0.0238 - gradient_norm: 1.5023 - val_det_loss: 0.4630 - val_cls_loss: 0.2916 - val_box_loss: 0.0034 - val_reg_l2_loss: 0.1115 - val_loss: 0.5745\n","Epoch 34/75\n","427/427 [==============================] - 393s 920ms/step - det_loss: 0.4617 - cls_loss: 0.2947 - box_loss: 0.0033 - reg_l2_loss: 0.1116 - loss: 0.5734 - learning_rate: 0.0230 - gradient_norm: 1.5162 - val_det_loss: 0.5332 - val_cls_loss: 0.3589 - val_box_loss: 0.0035 - val_reg_l2_loss: 0.1117 - val_loss: 0.6449\n","Epoch 35/75\n","427/427 [==============================] - 422s 988ms/step - det_loss: 0.4565 - cls_loss: 0.2905 - box_loss: 0.0033 - reg_l2_loss: 0.1118 - loss: 0.5682 - learning_rate: 0.0221 - gradient_norm: 1.5048 - val_det_loss: 0.5481 - val_cls_loss: 0.3752 - val_box_loss: 0.0035 - val_reg_l2_loss: 0.1118 - val_loss: 0.6599\n","Epoch 36/75\n","427/427 [==============================] - 391s 915ms/step - det_loss: 0.4504 - cls_loss: 0.2874 - box_loss: 0.0033 - reg_l2_loss: 0.1119 - loss: 0.5623 - learning_rate: 0.0213 - gradient_norm: 1.5514 - val_det_loss: 0.5265 - val_cls_loss: 0.3564 - val_box_loss: 0.0034 - val_reg_l2_loss: 0.1120 - val_loss: 0.6384\n","Epoch 37/75\n","427/427 [==============================] - 391s 916ms/step - det_loss: 0.4473 - cls_loss: 0.2851 - box_loss: 0.0032 - reg_l2_loss: 0.1120 - loss: 0.5593 - learning_rate: 0.0204 - gradient_norm: 1.5296 - val_det_loss: 0.5034 - val_cls_loss: 0.3248 - val_box_loss: 0.0036 - val_reg_l2_loss: 0.1120 - val_loss: 0.6154\n","Epoch 38/75\n","427/427 [==============================] - 393s 919ms/step - det_loss: 0.4406 - cls_loss: 0.2806 - box_loss: 0.0032 - reg_l2_loss: 0.1121 - loss: 0.5527 - learning_rate: 0.0196 - gradient_norm: 1.5397 - val_det_loss: 0.4987 - val_cls_loss: 0.3207 - val_box_loss: 0.0036 - val_reg_l2_loss: 0.1121 - val_loss: 0.6108\n","Epoch 39/75\n","427/427 [==============================] - 392s 917ms/step - det_loss: 0.4376 - cls_loss: 0.2788 - box_loss: 0.0032 - reg_l2_loss: 0.1121 - loss: 0.5497 - learning_rate: 0.0187 - gradient_norm: 1.5312 - val_det_loss: 0.5067 - val_cls_loss: 0.3331 - val_box_loss: 0.0035 - val_reg_l2_loss: 0.1121 - val_loss: 0.6188\n","Epoch 40/75\n","427/427 [==============================] - 423s 991ms/step - det_loss: 0.4304 - cls_loss: 0.2749 - box_loss: 0.0031 - reg_l2_loss: 0.1121 - loss: 0.5425 - learning_rate: 0.0179 - gradient_norm: 1.5829 - val_det_loss: 0.4454 - val_cls_loss: 0.2812 - val_box_loss: 0.0033 - val_reg_l2_loss: 0.1121 - val_loss: 0.5575\n","Epoch 41/75\n","427/427 [==============================] - 392s 918ms/step - det_loss: 0.4269 - cls_loss: 0.2712 - box_loss: 0.0031 - reg_l2_loss: 0.1121 - loss: 0.5390 - learning_rate: 0.0170 - gradient_norm: 1.5417 - val_det_loss: 0.4999 - val_cls_loss: 0.3242 - val_box_loss: 0.0035 - val_reg_l2_loss: 0.1121 - val_loss: 0.6120\n","Epoch 42/75\n","427/427 [==============================] - 391s 917ms/step - det_loss: 0.4209 - cls_loss: 0.2660 - box_loss: 0.0031 - reg_l2_loss: 0.1121 - loss: 0.5329 - learning_rate: 0.0162 - gradient_norm: 1.5457 - val_det_loss: 0.4814 - val_cls_loss: 0.3127 - val_box_loss: 0.0034 - val_reg_l2_loss: 0.1120 - val_loss: 0.5934\n","Epoch 43/75\n","427/427 [==============================] - 393s 921ms/step - det_loss: 0.4184 - cls_loss: 0.2649 - box_loss: 0.0031 - reg_l2_loss: 0.1120 - loss: 0.5304 - learning_rate: 0.0154 - gradient_norm: 1.5946 - val_det_loss: 0.4293 - val_cls_loss: 0.2732 - val_box_loss: 0.0031 - val_reg_l2_loss: 0.1120 - val_loss: 0.5413\n","Epoch 44/75\n","427/427 [==============================] - 394s 922ms/step - det_loss: 0.4123 - cls_loss: 0.2608 - box_loss: 0.0030 - reg_l2_loss: 0.1119 - loss: 0.5242 - learning_rate: 0.0146 - gradient_norm: 1.5748 - val_det_loss: 0.4292 - val_cls_loss: 0.2720 - val_box_loss: 0.0031 - val_reg_l2_loss: 0.1119 - val_loss: 0.5411\n","Epoch 45/75\n","427/427 [==============================] - 425s 996ms/step - det_loss: 0.4076 - cls_loss: 0.2590 - box_loss: 0.0030 - reg_l2_loss: 0.1118 - loss: 0.5195 - learning_rate: 0.0137 - gradient_norm: 1.5909 - val_det_loss: 0.5025 - val_cls_loss: 0.3341 - val_box_loss: 0.0034 - val_reg_l2_loss: 0.1118 - val_loss: 0.6143\n","Epoch 46/75\n","427/427 [==============================] - 393s 921ms/step - det_loss: 0.4008 - cls_loss: 0.2541 - box_loss: 0.0029 - reg_l2_loss: 0.1117 - loss: 0.5126 - learning_rate: 0.0129 - gradient_norm: 1.5694 - val_det_loss: 0.5118 - val_cls_loss: 0.3344 - val_box_loss: 0.0035 - val_reg_l2_loss: 0.1117 - val_loss: 0.6235\n","Epoch 47/75\n","427/427 [==============================] - 393s 921ms/step - det_loss: 0.4001 - cls_loss: 0.2526 - box_loss: 0.0030 - reg_l2_loss: 0.1116 - loss: 0.5117 - learning_rate: 0.0122 - gradient_norm: 1.6186 - val_det_loss: 0.4639 - val_cls_loss: 0.3060 - val_box_loss: 0.0032 - val_reg_l2_loss: 0.1115 - val_loss: 0.5754\n","Epoch 48/75\n","427/427 [==============================] - 393s 920ms/step - det_loss: 0.3949 - cls_loss: 0.2497 - box_loss: 0.0029 - reg_l2_loss: 0.1115 - loss: 0.5064 - learning_rate: 0.0114 - gradient_norm: 1.6143 - val_det_loss: 0.4520 - val_cls_loss: 0.2887 - val_box_loss: 0.0033 - val_reg_l2_loss: 0.1114 - val_loss: 0.5635\n","Epoch 49/75\n","427/427 [==============================] - 393s 920ms/step - det_loss: 0.3892 - cls_loss: 0.2472 - box_loss: 0.0028 - reg_l2_loss: 0.1114 - loss: 0.5006 - learning_rate: 0.0106 - gradient_norm: 1.6301 - val_det_loss: 0.4469 - val_cls_loss: 0.2866 - val_box_loss: 0.0032 - val_reg_l2_loss: 0.1113 - val_loss: 0.5582\n","Epoch 50/75\n","427/427 [==============================] - 425s 995ms/step - det_loss: 0.3834 - cls_loss: 0.2423 - box_loss: 0.0028 - reg_l2_loss: 0.1112 - loss: 0.4947 - learning_rate: 0.0099 - gradient_norm: 1.5822 - val_det_loss: 0.4536 - val_cls_loss: 0.2887 - val_box_loss: 0.0033 - val_reg_l2_loss: 0.1112 - val_loss: 0.5647\n","Epoch 51/75\n","427/427 [==============================] - 393s 919ms/step - det_loss: 0.3803 - cls_loss: 0.2405 - box_loss: 0.0028 - reg_l2_loss: 0.1111 - loss: 0.4913 - learning_rate: 0.0092 - gradient_norm: 1.5559 - val_det_loss: 0.4362 - val_cls_loss: 0.2828 - val_box_loss: 0.0031 - val_reg_l2_loss: 0.1110 - val_loss: 0.5472\n","Epoch 52/75\n","427/427 [==============================] - 393s 920ms/step - det_loss: 0.3757 - cls_loss: 0.2368 - box_loss: 0.0028 - reg_l2_loss: 0.1109 - loss: 0.4866 - learning_rate: 0.0085 - gradient_norm: 1.6072 - val_det_loss: 0.4182 - val_cls_loss: 0.2623 - val_box_loss: 0.0031 - val_reg_l2_loss: 0.1108 - val_loss: 0.5291\n","Epoch 53/75\n","427/427 [==============================] - 393s 920ms/step - det_loss: 0.3728 - cls_loss: 0.2352 - box_loss: 0.0028 - reg_l2_loss: 0.1108 - loss: 0.4835 - learning_rate: 0.0078 - gradient_norm: 1.6247 - val_det_loss: 0.4256 - val_cls_loss: 0.2669 - val_box_loss: 0.0032 - val_reg_l2_loss: 0.1107 - val_loss: 0.5363\n","Epoch 54/75\n","427/427 [==============================] - 394s 924ms/step - det_loss: 0.3702 - cls_loss: 0.2333 - box_loss: 0.0027 - reg_l2_loss: 0.1106 - loss: 0.4808 - learning_rate: 0.0071 - gradient_norm: 1.5973 - val_det_loss: 0.4434 - val_cls_loss: 0.2800 - val_box_loss: 0.0033 - val_reg_l2_loss: 0.1105 - val_loss: 0.5540\n","Epoch 55/75\n","427/427 [==============================] - 424s 993ms/step - det_loss: 0.3633 - cls_loss: 0.2298 - box_loss: 0.0027 - reg_l2_loss: 0.1105 - loss: 0.4738 - learning_rate: 0.0065 - gradient_norm: 1.6229 - val_det_loss: 0.4513 - val_cls_loss: 0.2914 - val_box_loss: 0.0032 - val_reg_l2_loss: 0.1104 - val_loss: 0.5617\n","Epoch 56/75\n","427/427 [==============================] - 393s 921ms/step - det_loss: 0.3584 - cls_loss: 0.2250 - box_loss: 0.0027 - reg_l2_loss: 0.1103 - loss: 0.4687 - learning_rate: 0.0059 - gradient_norm: 1.5880 - val_det_loss: 0.4435 - val_cls_loss: 0.2886 - val_box_loss: 0.0031 - val_reg_l2_loss: 0.1103 - val_loss: 0.5538\n","Epoch 57/75\n","427/427 [==============================] - 393s 920ms/step - det_loss: 0.3509 - cls_loss: 0.2207 - box_loss: 0.0026 - reg_l2_loss: 0.1102 - loss: 0.4611 - learning_rate: 0.0053 - gradient_norm: 1.5607 - val_det_loss: 0.4185 - val_cls_loss: 0.2660 - val_box_loss: 0.0030 - val_reg_l2_loss: 0.1101 - val_loss: 0.5286\n","Epoch 58/75\n","427/427 [==============================] - 392s 919ms/step - det_loss: 0.3513 - cls_loss: 0.2220 - box_loss: 0.0026 - reg_l2_loss: 0.1101 - loss: 0.4614 - learning_rate: 0.0047 - gradient_norm: 1.6133 - val_det_loss: 0.4193 - val_cls_loss: 0.2702 - val_box_loss: 0.0030 - val_reg_l2_loss: 0.1100 - val_loss: 0.5293\n","Epoch 59/75\n","427/427 [==============================] - 392s 919ms/step - det_loss: 0.3498 - cls_loss: 0.2200 - box_loss: 0.0026 - reg_l2_loss: 0.1100 - loss: 0.4597 - learning_rate: 0.0042 - gradient_norm: 1.5925 - val_det_loss: 0.4235 - val_cls_loss: 0.2748 - val_box_loss: 0.0030 - val_reg_l2_loss: 0.1099 - val_loss: 0.5334\n","Epoch 60/75\n","427/427 [==============================] - 424s 994ms/step - det_loss: 0.3453 - cls_loss: 0.2166 - box_loss: 0.0026 - reg_l2_loss: 0.1098 - loss: 0.4551 - learning_rate: 0.0037 - gradient_norm: 1.5460 - val_det_loss: 0.4317 - val_cls_loss: 0.2839 - val_box_loss: 0.0030 - val_reg_l2_loss: 0.1098 - val_loss: 0.5415\n","Epoch 61/75\n","427/427 [==============================] - 392s 919ms/step - det_loss: 0.3467 - cls_loss: 0.2187 - box_loss: 0.0026 - reg_l2_loss: 0.1097 - loss: 0.4564 - learning_rate: 0.0032 - gradient_norm: 1.6005 - val_det_loss: 0.4336 - val_cls_loss: 0.2809 - val_box_loss: 0.0031 - val_reg_l2_loss: 0.1097 - val_loss: 0.5433\n","Epoch 62/75\n","427/427 [==============================] - 393s 920ms/step - det_loss: 0.3416 - cls_loss: 0.2146 - box_loss: 0.0025 - reg_l2_loss: 0.1097 - loss: 0.4512 - learning_rate: 0.0028 - gradient_norm: 1.5683 - val_det_loss: 0.4229 - val_cls_loss: 0.2715 - val_box_loss: 0.0030 - val_reg_l2_loss: 0.1096 - val_loss: 0.5325\n","Epoch 63/75\n","427/427 [==============================] - 394s 923ms/step - det_loss: 0.3386 - cls_loss: 0.2132 - box_loss: 0.0025 - reg_l2_loss: 0.1096 - loss: 0.4482 - learning_rate: 0.0023 - gradient_norm: 1.5894 - val_det_loss: 0.4467 - val_cls_loss: 0.2866 - val_box_loss: 0.0032 - val_reg_l2_loss: 0.1095 - val_loss: 0.5563\n","Epoch 64/75\n","427/427 [==============================] - 393s 921ms/step - det_loss: 0.3374 - cls_loss: 0.2121 - box_loss: 0.0025 - reg_l2_loss: 0.1095 - loss: 0.4469 - learning_rate: 0.0020 - gradient_norm: 1.5696 - val_det_loss: 0.4486 - val_cls_loss: 0.2888 - val_box_loss: 0.0032 - val_reg_l2_loss: 0.1095 - val_loss: 0.5581\n","Epoch 65/75\n","427/427 [==============================] - 424s 993ms/step - det_loss: 0.3361 - cls_loss: 0.2110 - box_loss: 0.0025 - reg_l2_loss: 0.1095 - loss: 0.4455 - learning_rate: 0.0016 - gradient_norm: 1.5703 - val_det_loss: 0.4456 - val_cls_loss: 0.2875 - val_box_loss: 0.0032 - val_reg_l2_loss: 0.1094 - val_loss: 0.5550\n","Epoch 66/75\n","427/427 [==============================] - 389s 912ms/step - det_loss: 0.3362 - cls_loss: 0.2115 - box_loss: 0.0025 - reg_l2_loss: 0.1094 - loss: 0.4456 - learning_rate: 0.0013 - gradient_norm: 1.6049 - val_det_loss: 0.4328 - val_cls_loss: 0.2783 - val_box_loss: 0.0031 - val_reg_l2_loss: 0.1094 - val_loss: 0.5422\n","Epoch 67/75\n","427/427 [==============================] - 390s 914ms/step - det_loss: 0.3327 - cls_loss: 0.2088 - box_loss: 0.0025 - reg_l2_loss: 0.1094 - loss: 0.4421 - learning_rate: 0.0010 - gradient_norm: 1.6111 - val_det_loss: 0.4339 - val_cls_loss: 0.2787 - val_box_loss: 0.0031 - val_reg_l2_loss: 0.1093 - val_loss: 0.5432\n","Epoch 68/75\n","427/427 [==============================] - 390s 914ms/step - det_loss: 0.3327 - cls_loss: 0.2092 - box_loss: 0.0025 - reg_l2_loss: 0.1093 - loss: 0.4420 - learning_rate: 7.5812e-04 - gradient_norm: 1.5717 - val_det_loss: 0.4352 - val_cls_loss: 0.2795 - val_box_loss: 0.0031 - val_reg_l2_loss: 0.1093 - val_loss: 0.5445\n","Epoch 69/75\n","427/427 [==============================] - 391s 915ms/step - det_loss: 0.3294 - cls_loss: 0.2074 - box_loss: 0.0024 - reg_l2_loss: 0.1093 - loss: 0.4387 - learning_rate: 5.4420e-04 - gradient_norm: 1.5607 - val_det_loss: 0.4383 - val_cls_loss: 0.2804 - val_box_loss: 0.0032 - val_reg_l2_loss: 0.1093 - val_loss: 0.5476\n","Epoch 70/75\n","427/427 [==============================] - 418s 980ms/step - det_loss: 0.3308 - cls_loss: 0.2085 - box_loss: 0.0024 - reg_l2_loss: 0.1093 - loss: 0.4401 - learning_rate: 3.6535e-04 - gradient_norm: 1.5491 - val_det_loss: 0.4389 - val_cls_loss: 0.2813 - val_box_loss: 0.0032 - val_reg_l2_loss: 0.1093 - val_loss: 0.5482\n","Epoch 71/75\n","427/427 [==============================] - 390s 914ms/step - det_loss: 0.3302 - cls_loss: 0.2079 - box_loss: 0.0024 - reg_l2_loss: 0.1093 - loss: 0.4395 - learning_rate: 2.2187e-04 - gradient_norm: 1.5301 - val_det_loss: 0.4394 - val_cls_loss: 0.2817 - val_box_loss: 0.0032 - val_reg_l2_loss: 0.1093 - val_loss: 0.5487\n","Epoch 72/75\n","427/427 [==============================] - 391s 916ms/step - det_loss: 0.3310 - cls_loss: 0.2078 - box_loss: 0.0025 - reg_l2_loss: 0.1093 - loss: 0.4403 - learning_rate: 1.1404e-04 - gradient_norm: 1.5701 - val_det_loss: 0.4372 - val_cls_loss: 0.2804 - val_box_loss: 0.0031 - val_reg_l2_loss: 0.1093 - val_loss: 0.5465\n","Epoch 73/75\n","427/427 [==============================] - 390s 914ms/step - det_loss: 0.3310 - cls_loss: 0.2084 - box_loss: 0.0025 - reg_l2_loss: 0.1093 - loss: 0.4403 - learning_rate: 4.2045e-05 - gradient_norm: 1.5673 - val_det_loss: 0.4377 - val_cls_loss: 0.2805 - val_box_loss: 0.0031 - val_reg_l2_loss: 0.1093 - val_loss: 0.5470\n","Epoch 74/75\n","427/427 [==============================] - 391s 916ms/step - det_loss: 0.3291 - cls_loss: 0.2069 - box_loss: 0.0024 - reg_l2_loss: 0.1093 - loss: 0.4384 - learning_rate: 6.0143e-06 - gradient_norm: 1.5372 - val_det_loss: 0.4368 - val_cls_loss: 0.2797 - val_box_loss: 0.0031 - val_reg_l2_loss: 0.1093 - val_loss: 0.5461\n","Epoch 75/75\n","427/427 [==============================] - 418s 980ms/step - det_loss: 0.3288 - cls_loss: 0.2069 - box_loss: 0.0024 - reg_l2_loss: 0.1093 - loss: 0.4380 - learning_rate: 6.0141e-06 - gradient_norm: 1.5806 - val_det_loss: 0.4378 - val_cls_loss: 0.2804 - val_box_loss: 0.0031 - val_reg_l2_loss: 0.1093 - val_loss: 0.5470\n","Evaluating model...\n","48/48 [==============================] - 33s 497ms/step\n","\n","AP              : 0.56936127\n","AP50            : 0.73755914\n","AP75            : 0.6306804\n","APs             : 0.004549482\n","APm             : 0.28014815\n","APl             : 0.6008415\n","ARmax1          : 0.52907276\n","ARmax10         : 0.6929514\n","ARmax100        : 0.71753323\n","ARs             : 0.081587836\n","ARm             : 0.52957475\n","ARl             : 0.7549567\n","AP_/Person      : 0.1393162\n","AP_/Dog         : 0.7928916\n","AP_/Cat         : 0.7888609\n","AP_/Human_head  : 0.23130617\n","AP_/Deer        : 0.6881251\n","AP_/Squirrel    : 0.7376843\n","AP_/Bird        : 0.60734457\n","Evaluating tflite default...\n","1530/1530 [==============================] - 7865s 5s/step\n","\n","AP              : 0.549437\n","AP50            : 0.71938413\n","AP75            : 0.61566395\n","APs             : 4.7908015e-05\n","APm             : 0.24710047\n","APl             : 0.5792727\n","ARmax1          : 0.5149778\n","ARmax10         : 0.63979834\n","ARmax100        : 0.63979834\n","ARs             : 0.00125\n","ARm             : 0.3738194\n","ARl             : 0.68191344\n","AP_/Person      : 0.12197619\n","AP_/Dog         : 0.76592225\n","AP_/Cat         : 0.7662205\n","AP_/Human_head  : 0.21069612\n","AP_/Deer        : 0.6693947\n","AP_/Squirrel    : 0.70909375\n","AP_/Bird        : 0.6027554\n","Evaluating tflite float16...\n","1530/1530 [==============================] - 220s 143ms/step\n","\n","AP              : 0.55854344\n","AP50            : 0.7258133\n","AP75            : 0.61815536\n","APs             : 0.0008888389\n","APm             : 0.26793423\n","APl             : 0.5881184\n","ARmax1          : 0.5211278\n","ARmax10         : 0.6493765\n","ARmax100        : 0.6493765\n","ARs             : 0.01\n","ARm             : 0.38937765\n","ARl             : 0.6918942\n","AP_/Person      : 0.12676492\n","AP_/Dog         : 0.7773242\n","AP_/Cat         : 0.7756289\n","AP_/Human_head  : 0.21082889\n","AP_/Deer        : 0.6784195\n","AP_/Squirrel    : 0.7338503\n","AP_/Bird        : 0.6069874\n","Com.piling for \"model_default.tflite\" for Edge TPU...\n","File size of 5832 bytes will give 1 TPUs...\n","\n","edge_tpu_1\n","\n","Edge TPU Compiler version 16.0.384591198\n","Searching for valid delegate with step 1\n","Try to compile segment with 322 ops\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 321 ops\n","Intermediate tensors: tfl.dequantize,Sigmoid1\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 320 ops\n","Intermediate tensors: concat_1,Sigmoid1\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 319 ops\n","Intermediate tensors: Reshape_1,Reshape_3,Reshape_5,Reshape_7,Sigmoid1,Reshape_9\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 318 ops\n","Intermediate tensors: Reshape_1,Reshape_3,Reshape_5,Reshape_7,Sigmoid1,box_net/box-predict/BiasAdd_4;box_net/box-predict/separable_conv2d_4;box_net/box-predict/bias11\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 317 ops\n","Intermediate tensors: box_net/box-predict/separable_conv2d_4/depthwise1,Reshape_1,Reshape_3,Reshape_5,Reshape_7,Sigmoid1\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 316 ops\n","Intermediate tensors: Reshape_3,Reshape_5,Reshape_1,Reshape_7,Sigmoid1,Relu6_14;Relu6_14;box-2-bn-7/FusedBatchNormV3;box-2-bn-7/FusedBatchNormV3;box_net/box-2/bias;box-2/BiasAdd_4;box-2/BiasAdd_4;class_net/class-predict/separable_conv2d_4/depthwise;box-2/separable_conv2d_4;box-2/separable_conv2d_41\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 315 ops\n","Intermediate tensors: box-2/separable_conv2d_4/depthwise;box-2/separable_conv2d_4/depthwise1,Reshape_1,Reshape_3,Reshape_5,Reshape_7,Sigmoid1\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 314 ops\n","Intermediate tensors: Reshape_3,Reshape_1,Reshape_7,Reshape_5,Sigmoid1,Relu6_13;Relu6_13;box-1-bn-7/FusedBatchNormV3;box-1-bn-7/FusedBatchNormV3;box_net/box-1/bias;box-1/BiasAdd_4;box-1/BiasAdd_4;class_net/class-predict/separable_conv2d_4/depthwise;box-1/separable_conv2d_4;box-1/separable_conv2d_41\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 313 ops\n","Intermediate tensors: box-1/separable_conv2d_4/depthwise;box-1/separable_conv2d_4/depthwise1,Reshape_1,Reshape_3,Reshape_5,Reshape_7,Sigmoid1\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 312 ops\n","Intermediate tensors: Reshape_3,Reshape_5,Reshape_1,Reshape_7,Sigmoid1,Relu6_12;Relu6_12;box-0-bn-7/FusedBatchNormV3;box-0-bn-7/FusedBatchNormV3;box_net/box-0/bias;box-0/BiasAdd_4;box-0/BiasAdd_4;class_net/class-predict/separable_conv2d_4/depthwise;box-0/separable_conv2d_4;box-0/separable_conv2d_41\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 311 ops\n","Intermediate tensors: Reshape_1,Reshape_3,Reshape_5,Reshape_7,Sigmoid1,box-0/separable_conv2d_4/depthwise;box-0/separable_conv2d_4/depthwise1\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 310 ops\n","Intermediate tensors: cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d,Reshape_3,Reshape_5,Reshape_1,Reshape_7,Sigmoid1\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 309 ops\n","Intermediate tensors: cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d,Reshape_3,Reshape_5,Reshape_1,Reshape_7,Sigmoid\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 308 ops\n","Intermediate tensors: cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d,Reshape_1,Reshape_3,Reshape_5,Reshape_7,concat\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 307 ops\n","Intermediate tensors: Reshape_3,Reshape_6,Reshape_2,Reshape_5,Reshape_1,Reshape_4,Reshape_8,Reshape,Reshape_7,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 306 ops\n","Intermediate tensors: Reshape_3,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d,Reshape_7,class_net/class-predict/BiasAdd_4;class_net/class-predict/separable_conv2d_4;class_net/class-predict/bias11,Reshape,Reshape_4,Reshape_1,Reshape_5,Reshape_2,Reshape_6\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 305 ops\n","Intermediate tensors: Reshape_1,Reshape_4,Reshape,Reshape_7,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d,Reshape_3,class_net/class-predict/separable_conv2d_4/depthwise210,Reshape_6,Reshape_2,Reshape_5\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 304 ops\n","Intermediate tensors: Reshape_3,Reshape_6,Reshape_2,Reshape_5,Relu6_14;Relu6_14;class-2-bn-7/FusedBatchNormV3;class-2-bn-7/FusedBatchNormV3;class_net/class-2/bias;class-2/BiasAdd_4;class-2/BiasAdd_4;class_net/class-predict/separable_conv2d_4/depthwise;class-2/separable_conv2d_4;class-2/separable_conv2d_41,Reshape_1,Reshape_4,Reshape,Reshape_7,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 303 ops\n","Intermediate tensors: Reshape_1,Reshape_4,Reshape,Reshape_7,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d,Reshape_3,Reshape_6,Reshape_2,Reshape_5,class-2/separable_conv2d_4/depthwise;class-2/separable_conv2d_4/depthwise1\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 302 ops\n","Intermediate tensors: Reshape_2,Reshape_6,Reshape_1,Reshape_5,Reshape,Relu6_13;Relu6_13;class-1-bn-7/FusedBatchNormV3;class-1-bn-7/FusedBatchNormV3;class_net/class-1/bias;class-1/BiasAdd_4;class-1/BiasAdd_4;class_net/class-predict/separable_conv2d_4/depthwise;class-1/separable_conv2d_4;class-1/separable_conv2d_41,Reshape_4,Reshape_3,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d,Reshape_7\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 301 ops\n","Intermediate tensors: Reshape_1,Reshape_4,Reshape,Reshape_7,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d,Reshape_3,class-1/separable_conv2d_4/depthwise;class-1/separable_conv2d_4/depthwise1,Reshape_6,Reshape_2,Reshape_5\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 300 ops\n","Intermediate tensors: Reshape_3,Reshape_6,Relu6_12;Relu6_12;class-0-bn-7/FusedBatchNormV3;class-0-bn-7/FusedBatchNormV3;class_net/class-0/bias;class-0/BiasAdd_4;class-0/BiasAdd_4;class_net/class-predict/separable_conv2d_4/depthwise;class-0/separable_conv2d_4;class-0/separable_conv2d_41,Reshape_2,Reshape_5,Reshape_1,Reshape_4,Reshape,Reshape_7,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 299 ops\n","Intermediate tensors: Reshape_1,Reshape_4,Reshape,Reshape_7,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d,Reshape_3,Reshape_6,Reshape_2,Reshape_5,class-0/separable_conv2d_4/depthwise;class-0/separable_conv2d_4/depthwise1\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 298 ops\n","Intermediate tensors: Reshape_3,Reshape_6,Reshape_2,Reshape_5,Reshape_1,Reshape_4,Reshape,Reshape_7,cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_3/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_3/fnode7/op_after_combine12/conv/bias;cell_3/fnode7/op_after_combine12/conv/BiasAdd;cell_3/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d;cell_3/fnode7/op_after_combine12/conv/separable_conv2d\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 297 ops\n","Intermediate tensors: Reshape_3,Reshape_7,Reshape,Reshape_4,Reshape_1,Reshape_5,Reshape_2,cell_3/fnode7/op_after_combine12/conv/separable_conv2d/depthwise;cell_3/fnode7/op_after_combine12/conv/separable_conv2d/depthwise1,Reshape_6\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 296 ops\n","Intermediate tensors: Reshape_5,Reshape_1,Reshape_6,cell_3/fnode7/op_after_combine12/Relu6;cell_3/fnode7/op_after_combine12/Relu6;cell_3/fnode7/add_n/add;cell_3/fnode7/add_n/add,Reshape_2,Reshape_7,Reshape_3,Reshape_4,Reshape\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 295 ops\n","Intermediate tensors: Reshape,Reshape_5,Reshape_1,cell_3/fnode7/resample_1_11_12/max_pooling2d_15/MaxPool;cell_3/fnode7/resample_1_11_12/max_pooling2d_15/MaxPool,Reshape_6,Reshape_2,Reshape_7,Reshape_3,Reshape_4,cell_2/fnode7/op_after_combine12/bn/FusedBatchNormV3;cell_2/fnode7/op_after_combine12/bn/FusedBatchNormV3;fpn_cells/cell_2/fnode7/op_after_combine12/conv/bias;cell_2/fnode7/op_after_combine12/conv/BiasAdd;cell_2/fnode7/op_after_combine12/conv/BiasAdd;class_net/class-predict/separable_conv2d_4/depthwise;cell_2/fnode7/op_after_combine12/conv/separable_conv2d;cell_2/fnode7/op_after_combine12/conv/separable_conv2d\n","Started a compilation timeout timer of 180 seconds.\n","\n","Model compiled successfully in 2547 ms.\n","\n","Input model: model_default.tflite\n","Input size: 5.69MiB\n","Output model: edge_tpu_1/model_default_edgetpu.tflite\n","Output size: 6.55MiB\n","On-chip memory used for caching model parameters: 5.21MiB\n","On-chip memory remaining for caching model parameters: 2.29MiB\n","Off-chip memory used for streaming uncached model parameters: 0.00B\n","Number of Edge TPU subgraphs: 1\n","Total number of operations: 322\n","Operation log: edge_tpu_1/model_default_edgetpu.log\n","\n","Model successfully compiled but not all operations are supported by the Edge TPU. A percentage of the model will instead run on the CPU, which is slower. If possible, consider updating your model to use only operations supported by the Edge TPU. For details, visit g.co/coral/model-reqs.\n","Number of operations that will run on Edge TPU: 191\n","Number of operations that will run on CPU: 131\n","See the operation log file for individual operation details.\n","Compilation child process completed within timeout period.\n","Compilation succeeded! \n","\n","edge_tpu_2\n","\n","Edge TPU Compiler version 16.0.384591198\n","Started a compilation timeout timer of 180 seconds.\n","\n","Model compiled successfully in 3766 ms.\n","\n","Input model: model_default.tflite\n","Input size: 5.69MiB\n","Output model: edge_tpu_2/model_default_edgetpu.tflite\n","Output size: 7.35MiB\n","On-chip memory used for caching model parameters: 5.95MiB\n","On-chip memory remaining for caching model parameters: 1.56MiB\n","Off-chip memory used for streaming uncached model parameters: 0.00B\n","Number of Edge TPU subgraphs: 1\n","Total number of operations: 322\n","Operation log: edge_tpu_2/model_default_edgetpu.log\n","\n","Model successfully compiled but not all operations are supported by the Edge TPU. A percentage of the model will instead run on the CPU, which is slower. If possible, consider updating your model to use only operations supported by the Edge TPU. For details, visit g.co/coral/model-reqs.\n","Number of operations that will run on Edge TPU: 316\n","Number of operations that will run on CPU: 6\n","\n","Operator                       Count      Status\n","\n","RESHAPE                        1          More than one subgraph is not supported\n","RESHAPE                        9          Mapped to Edge TPU\n","CONCATENATION                  1          More than one subgraph is not supported\n","CONCATENATION                  1          Mapped to Edge TPU\n","LOGISTIC                       1          Operation is otherwise supported, but not mapped due to some unspecified limitation\n","CUSTOM                         1          Operation is working on an unsupported data type\n","ADD                            58         Mapped to Edge TPU\n","MAX_POOL_2D                    18         Mapped to Edge TPU\n","DEQUANTIZE                     2          Operation is working on an unsupported data type\n","QUANTIZE                       1          Mapped to Edge TPU\n","DEPTHWISE_CONV_2D              93         Mapped to Edge TPU\n","CONV_2D                        120        Mapped to Edge TPU\n","RESIZE_NEAREST_NEIGHBOR        16         Mapped to Edge TPU\n","Compilation child process completed within timeout period.\n","Compilation succeeded! \n","\n","Com.piling for \"model_int8.tflite\" for Edge TPU...\n","File size of 5832 bytes will give 1 TPUs...\n","\n","edge_tpu_1\n","\n","Edge TPU Compiler version 16.0.384591198\n","Searching for valid delegate with step 1\n","Try to compile segment with 330 ops\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 329 ops\n","Intermediate tensors: tfl.quantize1,StatefulPartitionedCall:1,StatefulPartitionedCall:2,StatefulPartitionedCall:0\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 328 ops\n","Intermediate tensors: tfl.quantize3,StatefulPartitionedCall:3,tfl.quantize4,StatefulPartitionedCall:2\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 327 ops\n","Intermediate tensors: tfl.quantize3,StatefulPartitionedCall:3,tfl.quantize4,tfl.quantize2\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 326 ops\n","Intermediate tensors: tfl.quantize1,tfl.quantize3,tfl.quantize4,tfl.quantize2\n","Started a compilation timeout timer of 180 seconds.\n","ERROR: Restored original execution plan after delegate application failure.\n","Compilation failed: Compilation failed due to large activation tensors in model.\n","Compilation child process completed within timeout period.\n","Compilation failed! \n","Try to compile segment with 325 ops\n","\n","edge_tpu_2\n","\n","Edge TPU Compiler version 16.0.384591198\n","Started a compilation timeout timer of 180 seconds.\n","\n","Model compiled successfully in 3699 ms.\n","\n","Input model: model_int8.tflite\n","Input size: 5.69MiB\n","Output model: edge_tpu_2/model_int8_edgetpu.tflite\n","Output size: 7.36MiB\n","On-chip memory used for caching model parameters: 5.95MiB\n","On-chip memory remaining for caching model parameters: 1.56MiB\n","Off-chip memory used for streaming uncached model parameters: 0.00B\n","Number of Edge TPU subgraphs: 1\n","Total number of operations: 330\n","Operation log: edge_tpu_2/model_int8_edgetpu.log\n","\n","Model successfully compiled but not all operations are supported by the Edge TPU. A percentage of the model will instead run on the CPU, which is slower. If possible, consider updating your model to use only operations supported by the Edge TPU. For details, visit g.co/coral/model-reqs.\n","Number of operations that will run on Edge TPU: 316\n","Number of operations that will run on CPU: 14\n","\n","Operator                       Count      Status\n","\n","LOGISTIC                       1          Operation is otherwise supported, but not mapped due to some unspecified limitation\n","CONCATENATION                  1          Mapped to Edge TPU\n","CONCATENATION                  1          More than one subgraph is not supported\n","MAX_POOL_2D                    18         Mapped to Edge TPU\n","RESHAPE                        1          More than one subgraph is not supported\n","RESHAPE                        9          Mapped to Edge TPU\n","CUSTOM                         1          Operation is working on an unsupported data type\n","ADD                            58         Mapped to Edge TPU\n","CONV_2D                        120        Mapped to Edge TPU\n","QUANTIZE                       1          Mapped to Edge TPU\n","QUANTIZE                       8          Operation is otherwise supported, but not mapped due to some unspecified limitation\n","RESIZE_NEAREST_NEIGHBOR        16         Mapped to Edge TPU\n","DEQUANTIZE                     2          Operation is working on an unsupported data type\n","DEPTHWISE_CONV_2D              93         Mapped to Edge TPU\n","Compilation child process completed within timeout period.\n","Compilation succeeded! \n","\n","Downloading to G-drive...\n","18_08_2022_efficientdet-lite1_e75_b32_s2000\n","model: efficientdet-lite1\n","batch_size: 32\n","Running model...\n","Epoch 1/100\n","427/427 [==============================] - 437s 920ms/step - det_loss: 0.9725 - cls_loss: 0.6480 - box_loss: 0.0065 - reg_l2_loss: 0.0722 - loss: 1.0447 - learning_rate: 0.0240 - gradient_norm: 2.1442 - val_det_loss: 1.1541 - val_cls_loss: 0.7748 - val_box_loss: 0.0076 - val_reg_l2_loss: 0.0738 - val_loss: 1.2279\n","Epoch 2/100\n","427/427 [==============================] - 391s 915ms/step - det_loss: 0.7526 - cls_loss: 0.4876 - box_loss: 0.0053 - reg_l2_loss: 0.0759 - loss: 0.8285 - learning_rate: 0.0400 - gradient_norm: 1.9771 - val_det_loss: 0.7866 - val_cls_loss: 0.5104 - val_box_loss: 0.0055 - val_reg_l2_loss: 0.0777 - val_loss: 0.8643\n","Epoch 3/100\n","427/427 [==============================] - 389s 912ms/step - det_loss: 0.7073 - cls_loss: 0.4558 - box_loss: 0.0050 - reg_l2_loss: 0.0793 - loss: 0.7866 - learning_rate: 0.0399 - gradient_norm: 1.8185 - val_det_loss: 0.6500 - val_cls_loss: 0.4257 - val_box_loss: 0.0045 - val_reg_l2_loss: 0.0808 - val_loss: 0.7308\n","Epoch 4/100\n","427/427 [==============================] - 390s 914ms/step - det_loss: 0.6845 - cls_loss: 0.4425 - box_loss: 0.0048 - reg_l2_loss: 0.0821 - loss: 0.7666 - learning_rate: 0.0399 - gradient_norm: 1.6817 - val_det_loss: 0.6872 - val_cls_loss: 0.4611 - val_box_loss: 0.0045 - val_reg_l2_loss: 0.0834 - val_loss: 0.7706\n","Epoch 5/100\n","427/427 [==============================] - 427s 1s/step - det_loss: 0.6607 - cls_loss: 0.4291 - box_loss: 0.0046 - reg_l2_loss: 0.0845 - loss: 0.7452 - learning_rate: 0.0398 - gradient_norm: 1.6111 - val_det_loss: 0.5769 - val_cls_loss: 0.3804 - val_box_loss: 0.0039 - val_reg_l2_loss: 0.0855 - val_loss: 0.6624\n","Epoch 6/100\n","427/427 [==============================] - 391s 916ms/step - det_loss: 0.6377 - cls_loss: 0.4110 - box_loss: 0.0045 - reg_l2_loss: 0.0866 - loss: 0.7243 - learning_rate: 0.0397 - gradient_norm: 1.5708 - val_det_loss: 0.6636 - val_cls_loss: 0.4318 - val_box_loss: 0.0046 - val_reg_l2_loss: 0.0875 - val_loss: 0.7511\n","Epoch 7/100\n","427/427 [==============================] - 390s 913ms/step - det_loss: 0.6215 - cls_loss: 0.4023 - box_loss: 0.0044 - reg_l2_loss: 0.0885 - loss: 0.7099 - learning_rate: 0.0396 - gradient_norm: 1.5840 - val_det_loss: 0.6759 - val_cls_loss: 0.4635 - val_box_loss: 0.0042 - val_reg_l2_loss: 0.0894 - val_loss: 0.7653\n","Epoch 8/100\n","427/427 [==============================] - 391s 915ms/step - det_loss: 0.6181 - cls_loss: 0.3996 - box_loss: 0.0044 - reg_l2_loss: 0.0904 - loss: 0.7085 - learning_rate: 0.0394 - gradient_norm: 1.5515 - val_det_loss: 0.6626 - val_cls_loss: 0.4439 - val_box_loss: 0.0044 - val_reg_l2_loss: 0.0912 - val_loss: 0.7539\n","Epoch 9/100\n","427/427 [==============================] - 390s 913ms/step - det_loss: 0.6082 - cls_loss: 0.3921 - box_loss: 0.0043 - reg_l2_loss: 0.0922 - loss: 0.7004 - learning_rate: 0.0393 - gradient_norm: 1.5449 - val_det_loss: 0.7744 - val_cls_loss: 0.5358 - val_box_loss: 0.0048 - val_reg_l2_loss: 0.0930 - val_loss: 0.8674\n","Epoch 10/100\n","427/427 [==============================] - 421s 986ms/step - det_loss: 0.6023 - cls_loss: 0.3891 - box_loss: 0.0043 - reg_l2_loss: 0.0938 - loss: 0.6962 - learning_rate: 0.0391 - gradient_norm: 1.5190 - val_det_loss: 0.6079 - val_cls_loss: 0.3935 - val_box_loss: 0.0043 - val_reg_l2_loss: 0.0946 - val_loss: 0.7025\n","Epoch 11/100\n","427/427 [==============================] - 391s 915ms/step - det_loss: 0.5875 - cls_loss: 0.3789 - box_loss: 0.0042 - reg_l2_loss: 0.0954 - loss: 0.6829 - learning_rate: 0.0389 - gradient_norm: 1.4978 - val_det_loss: 0.5662 - val_cls_loss: 0.3846 - val_box_loss: 0.0036 - val_reg_l2_loss: 0.0961 - val_loss: 0.6623\n","Epoch 12/100\n","427/427 [==============================] - 391s 915ms/step - det_loss: 0.5848 - cls_loss: 0.3776 - box_loss: 0.0041 - reg_l2_loss: 0.0969 - loss: 0.6817 - learning_rate: 0.0387 - gradient_norm: 1.4919 - val_det_loss: 0.5996 - val_cls_loss: 0.3953 - val_box_loss: 0.0041 - val_reg_l2_loss: 0.0976 - val_loss: 0.6972\n","Epoch 13/100\n","427/427 [==============================] - 391s 915ms/step - det_loss: 0.5809 - cls_loss: 0.3734 - box_loss: 0.0041 - reg_l2_loss: 0.0982 - loss: 0.6791 - learning_rate: 0.0384 - gradient_norm: 1.4845 - val_det_loss: 0.5971 - val_cls_loss: 0.3802 - val_box_loss: 0.0043 - val_reg_l2_loss: 0.0990 - val_loss: 0.6961\n","Epoch 14/100\n","427/427 [==============================] - 392s 918ms/step - det_loss: 0.5743 - cls_loss: 0.3691 - box_loss: 0.0041 - reg_l2_loss: 0.0996 - loss: 0.6739 - learning_rate: 0.0382 - gradient_norm: 1.4617 - val_det_loss: 0.6060 - val_cls_loss: 0.4085 - val_box_loss: 0.0040 - val_reg_l2_loss: 0.1002 - val_loss: 0.7063\n","Epoch 15/100\n","427/427 [==============================] - 420s 985ms/step - det_loss: 0.5655 - cls_loss: 0.3629 - box_loss: 0.0041 - reg_l2_loss: 0.1008 - loss: 0.6663 - learning_rate: 0.0379 - gradient_norm: 1.4487 - val_det_loss: 0.6181 - val_cls_loss: 0.4024 - val_box_loss: 0.0043 - val_reg_l2_loss: 0.1014 - val_loss: 0.7195\n","Epoch 16/100\n","427/427 [==============================] - 391s 915ms/step - det_loss: 0.5600 - cls_loss: 0.3597 - box_loss: 0.0040 - reg_l2_loss: 0.1020 - loss: 0.6620 - learning_rate: 0.0376 - gradient_norm: 1.4539 - val_det_loss: 0.6267 - val_cls_loss: 0.4093 - val_box_loss: 0.0043 - val_reg_l2_loss: 0.1026 - val_loss: 0.7293\n","Epoch 17/100\n","427/427 [==============================] - 390s 914ms/step - det_loss: 0.5533 - cls_loss: 0.3550 - box_loss: 0.0040 - reg_l2_loss: 0.1031 - loss: 0.6564 - learning_rate: 0.0373 - gradient_norm: 1.4504 - val_det_loss: 0.5836 - val_cls_loss: 0.3941 - val_box_loss: 0.0038 - val_reg_l2_loss: 0.1037 - val_loss: 0.6873\n","Epoch 18/100\n","427/427 [==============================] - 390s 915ms/step - det_loss: 0.5467 - cls_loss: 0.3501 - box_loss: 0.0039 - reg_l2_loss: 0.1041 - loss: 0.6509 - learning_rate: 0.0370 - gradient_norm: 1.4302 - val_det_loss: 0.5752 - val_cls_loss: 0.3715 - val_box_loss: 0.0041 - val_reg_l2_loss: 0.1047 - val_loss: 0.6799\n","Epoch 19/100\n","427/427 [==============================] - 392s 917ms/step - det_loss: 0.5419 - cls_loss: 0.3472 - box_loss: 0.0039 - reg_l2_loss: 0.1051 - loss: 0.6470 - learning_rate: 0.0367 - gradient_norm: 1.4296 - val_det_loss: 0.5406 - val_cls_loss: 0.3510 - val_box_loss: 0.0038 - val_reg_l2_loss: 0.1056 - val_loss: 0.6462\n","Epoch 20/100\n","427/427 [==============================] - 419s 983ms/step - det_loss: 0.5377 - cls_loss: 0.3451 - box_loss: 0.0039 - reg_l2_loss: 0.1061 - loss: 0.6438 - learning_rate: 0.0363 - gradient_norm: 1.4448 - val_det_loss: 0.5041 - val_cls_loss: 0.3170 - val_box_loss: 0.0037 - val_reg_l2_loss: 0.1066 - val_loss: 0.6106\n","Epoch 21/100\n","427/427 [==============================] - 390s 914ms/step - det_loss: 0.5349 - cls_loss: 0.3431 - box_loss: 0.0038 - reg_l2_loss: 0.1070 - loss: 0.6419 - learning_rate: 0.0359 - gradient_norm: 1.4399 - val_det_loss: 0.5309 - val_cls_loss: 0.3517 - val_box_loss: 0.0036 - val_reg_l2_loss: 0.1075 - val_loss: 0.6383\n","Epoch 22/100\n","427/427 [==============================] - 390s 914ms/step - det_loss: 0.5317 - cls_loss: 0.3405 - box_loss: 0.0038 - reg_l2_loss: 0.1079 - loss: 0.6396 - learning_rate: 0.0355 - gradient_norm: 1.4360 - val_det_loss: 0.5762 - val_cls_loss: 0.3939 - val_box_loss: 0.0036 - val_reg_l2_loss: 0.1083 - val_loss: 0.6845\n","Epoch 23/100\n","427/427 [==============================] - 390s 914ms/step - det_loss: 0.5282 - cls_loss: 0.3386 - box_loss: 0.0038 - reg_l2_loss: 0.1087 - loss: 0.6368 - learning_rate: 0.0351 - gradient_norm: 1.4169 - val_det_loss: 0.5655 - val_cls_loss: 0.3669 - val_box_loss: 0.0040 - val_reg_l2_loss: 0.1091 - val_loss: 0.6746\n","Epoch 24/100\n","427/427 [==============================] - 391s 916ms/step - det_loss: 0.5250 - cls_loss: 0.3361 - box_loss: 0.0038 - reg_l2_loss: 0.1095 - loss: 0.6345 - learning_rate: 0.0347 - gradient_norm: 1.4418 - val_det_loss: 0.5494 - val_cls_loss: 0.3805 - val_box_loss: 0.0034 - val_reg_l2_loss: 0.1099 - val_loss: 0.6593\n","Epoch 25/100\n","427/427 [==============================] - 420s 984ms/step - det_loss: 0.5198 - cls_loss: 0.3336 - box_loss: 0.0037 - reg_l2_loss: 0.1102 - loss: 0.6300 - learning_rate: 0.0343 - gradient_norm: 1.4330 - val_det_loss: 0.6444 - val_cls_loss: 0.4291 - val_box_loss: 0.0043 - val_reg_l2_loss: 0.1106 - val_loss: 0.7550\n","Epoch 26/100\n","427/427 [==============================] - 391s 915ms/step - det_loss: 0.5094 - cls_loss: 0.3264 - box_loss: 0.0037 - reg_l2_loss: 0.1109 - loss: 0.6203 - learning_rate: 0.0338 - gradient_norm: 1.4156 - val_det_loss: 0.5111 - val_cls_loss: 0.3234 - val_box_loss: 0.0038 - val_reg_l2_loss: 0.1112 - val_loss: 0.6224\n","Epoch 27/100\n","427/427 [==============================] - 391s 916ms/step - det_loss: 0.5061 - cls_loss: 0.3245 - box_loss: 0.0036 - reg_l2_loss: 0.1115 - loss: 0.6176 - learning_rate: 0.0333 - gradient_norm: 1.4249 - val_det_loss: 0.4993 - val_cls_loss: 0.3258 - val_box_loss: 0.0035 - val_reg_l2_loss: 0.1118 - val_loss: 0.6112\n","Epoch 28/100\n","427/427 [==============================] - 391s 916ms/step - det_loss: 0.5031 - cls_loss: 0.3221 - box_loss: 0.0036 - reg_l2_loss: 0.1121 - loss: 0.6152 - learning_rate: 0.0329 - gradient_norm: 1.4207 - val_det_loss: 0.5877 - val_cls_loss: 0.3920 - val_box_loss: 0.0039 - val_reg_l2_loss: 0.1124 - val_loss: 0.7001\n","Epoch 29/100\n","427/427 [==============================] - 390s 913ms/step - det_loss: 0.5016 - cls_loss: 0.3205 - box_loss: 0.0036 - reg_l2_loss: 0.1127 - loss: 0.6143 - learning_rate: 0.0324 - gradient_norm: 1.4399 - val_det_loss: 0.5265 - val_cls_loss: 0.3519 - val_box_loss: 0.0035 - val_reg_l2_loss: 0.1130 - val_loss: 0.6395\n","Epoch 30/100\n","427/427 [==============================] - 420s 985ms/step - det_loss: 0.4963 - cls_loss: 0.3179 - box_loss: 0.0036 - reg_l2_loss: 0.1132 - loss: 0.6096 - learning_rate: 0.0319 - gradient_norm: 1.4332 - val_det_loss: 0.4856 - val_cls_loss: 0.3153 - val_box_loss: 0.0034 - val_reg_l2_loss: 0.1135 - val_loss: 0.5991\n","Epoch 31/100\n","427/427 [==============================] - 391s 915ms/step - det_loss: 0.4933 - cls_loss: 0.3154 - box_loss: 0.0036 - reg_l2_loss: 0.1138 - loss: 0.6071 - learning_rate: 0.0313 - gradient_norm: 1.4521 - val_det_loss: 0.5795 - val_cls_loss: 0.3808 - val_box_loss: 0.0040 - val_reg_l2_loss: 0.1141 - val_loss: 0.6936\n","Epoch 32/100\n","427/427 [==============================] - 391s 915ms/step - det_loss: 0.4909 - cls_loss: 0.3132 - box_loss: 0.0036 - reg_l2_loss: 0.1143 - loss: 0.6052 - learning_rate: 0.0308 - gradient_norm: 1.4632 - val_det_loss: 0.5614 - val_cls_loss: 0.3833 - val_box_loss: 0.0036 - val_reg_l2_loss: 0.1146 - val_loss: 0.6760\n","Epoch 33/100\n","427/427 [==============================] - 390s 915ms/step - det_loss: 0.4910 - cls_loss: 0.3133 - box_loss: 0.0036 - reg_l2_loss: 0.1149 - loss: 0.6058 - learning_rate: 0.0303 - gradient_norm: 1.4773 - val_det_loss: 0.5124 - val_cls_loss: 0.3361 - val_box_loss: 0.0035 - val_reg_l2_loss: 0.1151 - val_loss: 0.6275\n","Epoch 34/100\n","427/427 [==============================] - 391s 916ms/step - det_loss: 0.4824 - cls_loss: 0.3079 - box_loss: 0.0035 - reg_l2_loss: 0.1153 - loss: 0.5977 - learning_rate: 0.0297 - gradient_norm: 1.4549 - val_det_loss: 0.6096 - val_cls_loss: 0.4051 - val_box_loss: 0.0041 - val_reg_l2_loss: 0.1155 - val_loss: 0.7252\n","Epoch 35/100\n","427/427 [==============================] - 420s 984ms/step - det_loss: 0.4810 - cls_loss: 0.3067 - box_loss: 0.0035 - reg_l2_loss: 0.1158 - loss: 0.5968 - learning_rate: 0.0292 - gradient_norm: 1.4676 - val_det_loss: 0.5490 - val_cls_loss: 0.3660 - val_box_loss: 0.0037 - val_reg_l2_loss: 0.1160 - val_loss: 0.6650\n","Epoch 36/100\n","427/427 [==============================] - 390s 912ms/step - det_loss: 0.4772 - cls_loss: 0.3030 - box_loss: 0.0035 - reg_l2_loss: 0.1161 - loss: 0.5933 - learning_rate: 0.0286 - gradient_norm: 1.4345 - val_det_loss: 0.4996 - val_cls_loss: 0.3220 - val_box_loss: 0.0036 - val_reg_l2_loss: 0.1163 - val_loss: 0.6159\n","Epoch 37/100\n"," 96/427 [=====\u003e........................] - ETA: 4:49 - det_loss: 0.4788 - cls_loss: 0.3004 - box_loss: 0.0036 - reg_l2_loss: 0.1163 - loss: 0.5951 - learning_rate: 0.0282 - gradient_norm: 1.4446"]}],"source":["for epochs_per_class in epochs_per_class_list:\n","  model = generate_model(spec_str,epochs_per_class)"]},{"cell_type":"markdown","metadata":{"id":"me6_RwPZqNhX"},"source":["## (Optional) Test the TFLite model on your image\n","\n","You can test the trained TFLite model using images from the internet.\n","* Replace the `INPUT_IMAGE_URL` below with your desired input image.\n","* Adjust the `DETECTION_THRESHOLD` to change the sensitivity of the model. A lower threshold means the model will pickup more objects but there will also be more false detection. Meanwhile, a higher threshold means the model will only pickup objects that it has confidently detected.\n","\n","Although it requires some of boilerplate code to run the model in Python at this moment, integrating the model into a mobile app only requires a few lines of code."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"XqS0rFCrqM1o"},"outputs":[],"source":["#@title Load the trained TFLite model and define some visualization functions\n","\n","import cv2\n","\n","from PIL import Image\n","\n","from matplotlib import pyplot as plt\n","\n","model_path = 'model_default.tflite'\n","\n","# Load the labels into a list\n","classes = ['???'] * model.model_spec.config.num_classes\n","label_map = model.model_spec.config.label_map\n","for label_id, label_name in label_map.as_dict().items():\n","  classes[label_id-1] = label_name\n","\n","# Define a list of colors for visualization\n","COLORS = np.random.randint(0, 255, size=(len(classes), 3), dtype=np.uint8)\n","\n","def preprocess_image(image_path, input_size):\n","  \"\"\"Preprocess the input image to feed to the TFLite model\"\"\"\n","  img = tf.io.read_file(image_path)\n","  img = tf.io.decode_image(img, channels=3)\n","  img = tf.image.convert_image_dtype(img, tf.uint8)\n","  original_image = img\n","  resized_img = tf.image.resize(img, input_size)\n","  resized_img = resized_img[tf.newaxis, :]\n","  resized_img = tf.cast(resized_img, dtype=tf.uint8)\n","  return resized_img, original_image\n","\n","\n","def detect_objects(interpreter, image, threshold):\n","  \"\"\"Returns a list of detection results, each a dictionary of object info.\"\"\"\n","\n","  signature_fn = interpreter.get_signature_runner()\n","\n","  # Feed the input image to the model\n","  output = signature_fn(images=image)\n","\n","  # Get all outputs from the model\n","  count = int(np.squeeze(output['output_0']))\n","  scores = np.squeeze(output['output_1'])\n","  classes = np.squeeze(output['output_2'])\n","  boxes = np.squeeze(output['output_3'])\n","\n","  results = []\n","  for i in range(count):\n","    if scores[i] \u003e= threshold:\n","      result = {\n","        'bounding_box': boxes[i],\n","        'class_id': classes[i],\n","        'score': scores[i]\n","      }\n","      results.append(result)\n","  return results\n","\n","\n","def run_odt_and_draw_results(image_path, interpreter, threshold=0.5):\n","  \"\"\"Run object detection on the input image and draw the detection results\"\"\"\n","  # Load the input shape required by the model\n","  _, input_height, input_width, _ = interpreter.get_input_details()[0]['shape']\n","\n","  # Load the input image and preprocess it\n","  preprocessed_image, original_image = preprocess_image(\n","      image_path,\n","      (input_height, input_width)\n","    )\n","\n","  # Run object detection on the input image\n","  results = detect_objects(interpreter, preprocessed_image, threshold=threshold)\n","\n","  # Plot the detection results on the input image\n","  original_image_np = original_image.numpy().astype(np.uint8)\n","  for obj in results:\n","    # Convert the object bounding box from relative coordinates to absolute\n","    # coordinates based on the original image resolution\n","    ymin, xmin, ymax, xmax = obj['bounding_box']\n","    xmin = int(xmin * original_image_np.shape[1])\n","    xmax = int(xmax * original_image_np.shape[1])\n","    ymin = int(ymin * original_image_np.shape[0])\n","    ymax = int(ymax * original_image_np.shape[0])\n","\n","    # Find the class index of the current object\n","    class_id = int(obj['class_id'])\n","\n","    # Draw the bounding box and label on the image\n","    color = [int(c) for c in COLORS[class_id]]\n","    cv2.rectangle(original_image_np, (xmin, ymin), (xmax, ymax), color, 2)\n","    # Make adjustments to make the label visible for all objects\n","    y = ymin - 15 if ymin - 15 \u003e 15 else ymin + 15\n","    label = \"{}: {:.0f}%\".format(classes[class_id], obj['score'] * 100)\n","    cv2.putText(original_image_np, label, (xmin, y),\n","        cv2.FONT_HERSHEY_SIMPLEX, 0.5, color, 2)\n","\n","  # Return the final image\n","  original_uint8 = original_image_np.astype(np.uint8)\n","  return original_uint8"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"GkXtipXKqXp4"},"outputs":[],"source":["DETECTION_THRESHOLD = 0.2 #@param {type:\"number\"}\n","\n","INPUT_IMAGE_URL_ARR = [\n","\"https://post.healthline.com/wp-content/uploads/2020/01/Runner-training-on-running-track-1296x728-header-1296x728.jpg\",\n","\"https://cdn.shopify.com/s/files/1/0392/1897/articles/Festivalkalender-2022_1024x1024.jpg?v=1638444160\",\n","\"https://soundvenue.com/wp-content/uploads/2019/06/041A3792-1904x1071.jpg?v=1635850983\",\n","\"https://www.aaha.org/contentassets/e3033f0ae87246cbb1ef8136c13d508f/imagehywzk.png\",\n","\"https://image.cnbcfm.com/api/v1/image/107090880-1658245843850-mandy_with_pups.jpg\",\n","\"https://imgb.srgcdn.com/oi68K1ZTqpU5LH6wwLBT.jpg?width=1024\",\n","\"https://c.ndtvimg.com/dog_625x300_1529560762023.jpg\",\n","\"https://upload.wikimedia.org/wikipedia/commons/thumb/0/0b/Cat_poster_1.jpg/1280px-Cat_poster_1.jpg\",\n","\"https://media-cldnry.s-nbcnews.com/image/upload/newscms/2019_38/3019821/190920-kristyn-vitale-cat-2-ew-444p.jpg\",\n","\"http://media2.s-nbcnews.com/i/streams/2014/May/140516/2D274905869133-today-hero-cat-140516-split.jpg\",\n","\"https://media.lex.dk/media/43340/standard_compressed_Raadyr.jpg\",\n","\"https://fanonatur.dk/wp-content/uploads/2020/03/Raadyr-080304-DSC_0626-1.jpg\",\n","\"https://www.feltration.dk/files/99/media/3374-forskel-pa-radyr-og-dadyr-hurtig-guide.jpg\",\n","\"https://www.information.dk/sites/information.dk/files/styles/580x/public/media/2020/02/26/20151221-111701-2-1920x1275we.jpg\",\n","\"https://bt.bmcdn.dk/media/cache/resolve/image_1240/image/30/302477/7939024-rdyr1.jpg\",\n","\"https://grosaugerud.files.wordpress.com/2015/05/dsc3016.jpg\",\n","\"https://dk-drupaller-prod-s3bucket-ymg73fqfni8n.s3.amazonaws.com/familiejournal/s3fs-public/styles/full_height_8grid/public/media/7c22247ade334c1daed9305523029d0e.jpg\"\n","]\n","\n","i = 0\n","for INPUT_IMAGE_URL in INPUT_IMAGE_URL_ARR:\n","\n","  TEMP_FILE = '/tmp/image.png'\n","\n","  !wget -q -O $TEMP_FILE $INPUT_IMAGE_URL\n","  im = Image.open(TEMP_FILE)\n","  im.thumbnail((512, 512), Image.ANTIALIAS)\n","  im.save(TEMP_FILE, 'PNG')\n","\n","  # Load the TFLite model\n","  interpreter = tf.lite.Interpreter(model_path=model_path)\n","  interpreter.allocate_tensors()\n","\n","  # Run inference and draw detection result on the local copy of the original file\n","  detection_result_image = run_odt_and_draw_results(\n","      TEMP_FILE,\n","      interpreter,\n","      threshold=DETECTION_THRESHOLD\n","  )\n","\n","  plt.figure(figsize=(8,8))\n","  plt.imshow(cv2.cvtColor(detection_result_image, cv2.COLOR_BGR2RGB))\n","  plt.show()\n"]},{"cell_type":"markdown","metadata":{"id":"oxgWQyYOqZha"},"source":["## (Optional) Compile For the Edge TPU\n","\n","*   List item\n","\n","*   List item\n","*   List item\n","\n","\n","*   List item\n","\n","\n","\n","Now that you have a quantized EfficientDet Lite model, it is possible to compile and deploy to a [Coral EdgeTPU](https://coral.ai/).\n","\n","**Step 1. Install the EdgeTPU Compiler**"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Oy3QIn_YqaRP"},"outputs":[],"source":["#! curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -\n","#\n","#! echo \"deb https://packages.cloud.google.com/apt coral-edgetpu-stable main\" | sudo tee /etc/apt/sources.list.d/coral-edgetpu.list\n","#\n","#! sudo apt-get update\n","#\n","#! sudo apt-get install edgetpu-compiler"]},{"cell_type":"markdown","metadata":{"id":"qRWewhqFqeL_"},"source":["**Step 2. Select number of Edge TPUs, Compile**\n","\n","The EdgeTPU has 8MB of SRAM for caching model paramaters ([more info](https://coral.ai/docs/edgetpu/compiler/#parameter-data-caching)). This means that for models that are larger than 8MB, inference time will be increased in order to transfer over model paramaters. One way to avoid this is [Model Pipelining](https://coral.ai/docs/edgetpu/pipeline/) - splitting the model into segments that can have a dedicated EdgeTPU. This can significantly improve latency.\n","\n","The below table can be used as a reference for the number of Edge TPUs to use - the larger models will not compile for a single TPU as the intermediate tensors can't fit in on-chip memory.\n","\n","| Model architecture | Minimum TPUs | Recommended TPUs\n","|--------------------|-------|-------|\n","| EfficientDet-Lite0 | 1     | 1     |\n","| EfficientDet-Lite1 | 1     | 1     |\n","| EfficientDet-Lite2 | 1     | 2     |\n","| EfficientDet-Lite3 | 2     | 2     |\n","| EfficientDet-Lite4 | 2     | 3     |"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"LZdonJGCqieU"},"outputs":[],"source":["#NUMBER_OF_TPUS =  1#@param {type:\"number\"}\n","#\n","#!edgetpu_compiler model_dynamic.tflite --num_segments=$NUMBER_OF_TPUS"]},{"cell_type":"markdown","metadata":{"id":"-g6_KQXnqlTC"},"source":["**Step 3. Download, Run Model**\n","\n","With the model(s) compiled, they can now be run on EdgeTPU(s) for object detection. First, download the compiled TensorFlow Lite model file using the left sidebar of Colab. Right-click on the `model_edgetpu.tflite` file and choose `Download` to download it to your local computer."]},{"cell_type":"markdown","metadata":{"id":"VkQFz_qzqrrA"},"source":["Now you can run the model in your preferred manner. Examples of detection include:\n","* [pycoral detection](https://github.com/google-coral/pycoral/blob/master/examples/detect_image.py)\n","* [Basic TFLite detection](https://github.com/google-coral/tflite/tree/master/python/examples/detection)\n","* [Example Video Detection](https://github.com/google-coral/examples-camera)\n","* [libcoral C++ API](https://github.com/google-coral/libcoral)\n"]},{"cell_type":"markdown","metadata":{"id":"EoWiA_zX8rxE"},"source":["## Advanced Usage\n","\n","This section covers advanced usage topics like adjusting the model and the training hyperparameters."]},{"cell_type":"markdown","metadata":{"id":"p79NHCx0xFqb"},"source":["### Load the dataset\n","\n","#### Load your own data\n","\n","You can upload your own dataset to work through this tutorial. Upload your dataset by using the left sidebar in Colab.\n","\n","\u003cimg src=\"https://storage.googleapis.com/download.tensorflow.org/models/tflite/screenshots/model_maker_object_detection.png\" alt=\"Upload File\" width=\"1000\" hspace=\"0\"\u003e\n","\n","If you prefer not to upload your dataset to the cloud, you can also locally run the library by following the [guide](https://github.com/tensorflow/examples/tree/master/tensorflow_examples/lite/model_maker).\n","\n","#### Load your data with a different data format\n","\n","The Model Maker library also supports the `object_detector.DataLoader.from_pascal_voc` method to load data with [PASCAL VOC](https://towardsdatascience.com/coco-data-format-for-object-detection-a4c5eaf518c5#:~:text=Pascal%20VOC%20is%20an%20XML,for%20training%2C%20testing%20and%20validation) format. [makesense.ai](https://www.makesense.ai/) and [LabelImg](https://github.com/tzutalin/labelImg) are the tools that can annotate the image and save annotations as XML files in PASCAL VOC data format:\n","```python\n","object_detector.DataLoader.from_pascal_voc(image_dir, annotations_dir, label_map={1: \"person\", 2: \"notperson\"})\n","```\n"]},{"cell_type":"markdown","metadata":{"id":"E8VxPiOLy4Gv"},"source":["### Customize the EfficientDet model hyperparameters\n","\n","The model and training pipline parameters you can adjust are:\n","\n","* `model_dir`: The location to save the model checkpoint files. If not set, a temporary directory will be used.\n","* `steps_per_execution`: Number of steps per training execution.\n","* `moving_average_decay`: Float. The decay to use for maintaining moving averages of the trained parameters.\n","* `var_freeze_expr`: The regular expression to map the prefix name of variables to be frozen which means remaining the same during training. More specific, use `re.match(var_freeze_expr, variable_name)` in the codebase to map the variables to be frozen.\n","* `tflite_max_detections`: integer, 25 by default. The max number of output detections in the TFLite model.\n","* `strategy`:  A string specifying which distribution strategy to use. Accepted values are 'tpu', 'gpus', None. tpu' means to use TPUStrategy. 'gpus' mean to use MirroredStrategy for multi-gpus. If None, use TF default with OneDeviceStrategy.\n","* `tpu`:  The Cloud TPU to use for training. This should be either the name used when creating the Cloud TPU, or a grpc://ip.address.of.tpu:8470 url.\n","* `use_xla`: Use XLA even if strategy is not tpu. If strategy is tpu, always use XLA, and this flag has no effect.\n","* `profile`: Enable profile mode.\n","* `debug`: Enable debug mode.\n","\n","Other parameters that can be adjusted is shown in [hparams_config.py](https://github.com/google/automl/blob/df451765d467c5ed78bbdfd632810bc1014b123e/efficientdet/hparams_config.py#L170).\n","\n","\n","For instance, you can set the `var_freeze_expr='efficientnet'` which freezes the variables with name prefix `efficientnet` (default is `'(efficientnet|fpn_cells|resample_p6)'`). This allows the model to freeze untrainable variables and keep their value the same through training.\n","\n","```python\n","spec = model_spec.get('efficientdet_lite0')\n","spec.config.var_freeze_expr = 'efficientnet'\n","```"]},{"cell_type":"markdown","metadata":{"id":"4J2qre1fwXsi"},"source":["### Change the Model Architecture\n","\n","You can change the model architecture by changing the `model_spec`. For instance, change the `model_spec` to the EfficientDet-Lite4 model.\n","\n","```python\n","spec = model_spec.get('efficientdet_lite4')\n","```"]},{"cell_type":"markdown","metadata":{"id":"LvQuy7RSDir3"},"source":["### Tune the training hyperparameters\n","\n","The `create` function is the driver function that the Model Maker library uses to create models. The `model_spec` parameter defines the model specification. The `object_detector.EfficientDetSpec` class is currently supported. The `create` function comprises of the following steps:\n","\n","1. Creates the model for the object detection according to `model_spec`.\n","2. Trains the model.  The default epochs and the default batch size are set by the `epochs` and `batch_size` variables in the `model_spec` object.\n","You can also tune the training hyperparameters like `epochs` and `batch_size` that affect the model accuracy. For instance,\n","\n","*   `epochs`: Integer, 50 by default. More epochs could achieve better accuracy, but may lead to overfitting.\n","*   `batch_size`: Integer, 64 by default. The number of samples to use in one training step.\n","*   `train_whole_model`: Boolean, False by default. If true, train the whole model. Otherwise, only train the layers that do not match `var_freeze_expr`.\n","\n","For example, you can train with less epochs and only the head layer. You can increase the number of epochs for better results.\n","\n","```python\n","model = object_detector.create(train_data, model_spec=spec, epochs=10, validation_data=validation_data)\n","```"]},{"cell_type":"markdown","metadata":{"id":"3vPyZInPxJBT"},"source":["### Export to different formats"]},{"cell_type":"markdown","metadata":{"id":"0xqNIcBM-4YR"},"source":["The export formats can be one or a list of the following:\n","\n","*   `ExportFormat.TFLITE`\n","*   `ExportFormat.LABEL`\n","*   `ExportFormat.SAVED_MODEL`\n","\n","\n"]},{"cell_type":"markdown","metadata":{"id":"enhsZhW3ApcX"},"source":["By default, it exports only the TensorFlow Lite model file containing the model [metadata](https://www.tensorflow.org/lite/models/convert/metadata) so that you can later use in an on-device ML application. The label file is embedded in metadata.\n","\n","In many on-device ML application, the model size is an important factor. Therefore, it is recommended that you quantize the model to make it smaller and potentially run faster. As for EfficientDet-Lite models, full integer quantization  is used to quantize the model by default. Please refer to [Post-training quantization](https://www.tensorflow.org/lite/performance/post_training_quantization) for more detail.\n","\n","```python\n","model.export(export_dir='.')\n","```"]},{"cell_type":"markdown","metadata":{"id":"RLGZs6InAnP5"},"source":["You can also choose to export other files related to the model for better examination. For instance, exporting both the saved model and the label file as follows:\n","```python\n","model.export(export_dir='.', export_format=[ExportFormat.SAVED_MODEL, ExportFormat.LABEL])\n","```"]},{"cell_type":"markdown","metadata":{"id":"W5q_McchQ2C4"},"source":["### Customize Post-training quantization on the TensorFlow Lite model\n","\n","[Post-training quantization](https://www.tensorflow.org/lite/performance/post_training_quantization) is a conversion technique that can reduce model size and inference latency, while also improving CPU and hardware accelerator inference speed, with a little degradation in model accuracy. Thus, it's widely used to optimize the model.\n","\n","Model Maker library applies a default post-training quantization techique when exporting the model. If you want to customize post-training quantization, Model Maker supports multiple post-training quantization options using [QuantizationConfig](https://www.tensorflow.org/lite/api_docs/python/tflite_model_maker/config/QuantizationConfig) as well. Let's take float16 quantization as an instance. First, define the quantization config.\n","\n","```python\n","config = QuantizationConfig.for_float16()\n","```\n","\n","\n","Then we export the TensorFlow Lite model with such configuration.\n","\n","```python\n","model.export(export_dir='.', tflite_filename='model_fp16.tflite', quantization_config=config)\n","```"]},{"cell_type":"markdown","metadata":{"id":"HS4u77W5gnzQ"},"source":["# Read more\n","\n","You can read our [object detection](https://www.tensorflow.org/lite/examples/object_detection/overview) example to learn technical details. For more information, please refer to:\n","\n","*   TensorFlow Lite Model Maker [guide](https://www.tensorflow.org/lite/models/modify/model_maker) and [API reference](https://www.tensorflow.org/lite/api_docs/python/tflite_model_maker).\n","*   Task Library: [ObjectDetector](https://www.tensorflow.org/lite/inference_with_metadata/task_library/object_detector) for deployment.\n","*   The end-to-end reference apps: [Android](https://github.com/tensorflow/examples/tree/master/lite/examples/object_detection/android), [iOS](https://github.com/tensorflow/examples/tree/master/lite/examples/object_detection/ios), and [Raspberry PI](https://github.com/tensorflow/examples/tree/master/lite/examples/object_detection/raspberry_pi).\n","\n"]}],"metadata":{"accelerator":"GPU","colab":{"background_execution":"on","collapsed_sections":[],"machine_shape":"hm","name":"Model Maker Object Detection v4","provenance":[{"file_id":"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/lite/g3doc/models/modify/model_maker/object_detection.ipynb","timestamp":1658693021365},{"file_id":"1dbRXQCjtm-jBFC32DJ6YCVXnXBOG3M5t","timestamp":1613441434239},{"file_id":"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/lite/g3doc/models/modify/model_maker/text_classification.ipynb","timestamp":1612303859066}],"version":""},"gpuClass":"standard","kernelspec":{"display_name":"Python 3","name":"python3"}},"nbformat":4,"nbformat_minor":0}